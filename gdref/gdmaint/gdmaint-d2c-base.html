<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Base</CODE
></FONT
> Library</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.13"><LINK
REL="HOME"
TITLE="Gwydion Dylan Porting and Maintenance Guide"
HREF="gdmaint.html"><LINK
REL="UP"
TITLE="d2c Internals Guide"
HREF="gdmaint-d2c-internals.html"><LINK
REL="PREVIOUS"
TITLE="d2c Internals Guide"
HREF="gdmaint-d2c-internals.html"><LINK
REL="NEXT"
TITLE="The Compiler-Parser Library"
HREF="gdmaint-d2c-parser.html"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Gwydion Dylan Porting and Maintenance Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="gdmaint-d2c-internals.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. <B
CLASS="COMMAND"
>d2c</B
> Internals Guide</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="gdmaint-d2c-parser.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="GDMAINT-D2C-BASE"
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Base</CODE
></FONT
> Library</A
></H1
><P
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Base</CODE
></FONT
> library exports the
      basic data structures used by the compiler. It also provides a number
      of miscellaneous utility modules. Every other library relies on
      <FONT
COLOR="GREEN"
><CODE
>Compiler-Base</CODE
></FONT
>.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-MISCELLANEOUS"
>Miscellaneous Utility Modules</A
></H2
><P
>Several modules in <FONT
COLOR="GREEN"
><CODE
>Compiler-Base</CODE
></FONT
> appear
	to contain assorted utility routines used elsewhere in the
	compiler.</P
><P
></P
><DL
><DT
><FONT
COLOR="GREEN"
><CODE
>Common</CODE
></FONT
></DT
><DD
><P
>This module imports a number of standard modules and
	      re-exports some or all of their constants. Essentially, this
	      module is used to specify a local Dylan dialect for use by
	      the rest of the compiler. It includes
	      <FONT
COLOR="GREEN"
><CODE
>Dylan</CODE
></FONT
>, some of
	      <FONT
COLOR="GREEN"
><CODE
>Extensions</CODE
></FONT
>, a few names from
	      <FONT
COLOR="GREEN"
><CODE
>Table-Extensions</CODE
></FONT
> and several of the
	      <SPAN
CLASS="ABBREV"
>I/O</SPAN
>-related modules.
	    </P
></DD
><DT
><FONT
COLOR="GREEN"
><CODE
>File-System</CODE
></FONT
></DT
><DD
><P
>This module provides a local implementation of parts of
	      the <FONT
COLOR="GREEN"
><CODE
>File-System</CODE
></FONT
> library. We can't
	      replace this with the standard implementation without
	      breaking the ability to bootstrap <B
CLASS="COMMAND"
>d2c</B
> with existing version
	      2.2.0 binaries.</P
></DD
><DT
><FONT
COLOR="GREEN"
><CODE
>Utils</CODE
></FONT
></DT
><DD
><P
>This appears to be the &#8220;grab bag&#8221;
	      module. It holds a mix of completely unrelated minor classes
	      and functions.</P
></DD
></DL
><H2
><A
NAME="GDMAINT-D2C-BASE-OD-FORMAT"
>The <FONT
COLOR="GREEN"
><CODE
>OD-Format</CODE
></FONT
> Module</A
></H2
><P
>The <FONT
COLOR="GREEN"
><CODE
>OD-Format</CODE
></FONT
> module implements the
	<I
CLASS="GLOSSTERM"
>Object Description Format</I
>, a binary format
	for storing persistent objects. This is used by the
	<TT
CLASS="FILENAME"
>*.lib.du</TT
> files emitted by <B
CLASS="COMMAND"
>d2c</B
>, though it
	might be potentially useful elsewhere.</P
><P
>The file
	<TT
CLASS="FILENAME"
>gd/src/d2c/compiler/base/od-format.dylan</TT
>
	contains an extensive discussion the module's goals and data
	format. From the top-of-file comment:</P
><BLOCKQUOTE
><P
>The basic requirement of the "Object Description Format"
          (ODF) is to allow an open-ended variety of objects to be dumped
          into a file, where:</P
><P
></P
><UL
><LI
><P
>instances may refer to each other in an arbitrary graph
	      structure, and</P
></LI
><LI
><P
>some of the references may be to objects that are
              defined in distinct object description units (files,
              etc.)</P
></LI
></UL
><P
>In order to make the design interesting, the ODF attempts
          to satisfy various incompatible requirements:</P
><P
></P
><UL
><LI
><P
>To support efficient parsing and unparsing on a variety
              of architectures, but also to potentially serve as a
              cross-platform interchange format.</P
></LI
><LI
><P
>To work well on sequential media (like a socket), but
              also to potentially support random-access demand-loading of
              objects when possible (e.g. on files.)</P
></LI
></UL
></BLOCKQUOTE
><P
>We should consider making this into a standalone library at
	some point in the future.</P
><TABLE
WIDTH="100%"
CELLPADDING="0"
BORDER="0"
><TR
><TD
><B
><FONT
COLOR="GREEN"
><CODE
>dump-od</CODE
></FONT
></B
></TD
><TD
ALIGN="RIGHT"
><STRONG
>[Open Generic]</STRONG
></TD
></TR
></TABLE
><HR><BLOCKQUOTE
>Write an object to the dump buffer.</BLOCKQUOTE
><P
><STRONG
>Synopsis</STRONG
></P
><BLOCKQUOTE
>dump-od (<EM
>object</EM
>, <EM
>buffer</EM
>) =&#62; ()</BLOCKQUOTE
><P
><STRONG
>Parameters</STRONG
></P
><BLOCKQUOTE
><TABLE
BORDER="0"
COLUMNSPACING="0"
><TR
><TD
VALIGN="TOP"
><EM
>object</EM
></TD
><TD
>An instance of <FONT
COLOR="GREEN"
><CODE
>&#60;object&#62;</CODE
></FONT
>. The object to dump.</TD
></TR
><TR
><TD
VALIGN="TOP"
><EM
>buffer</EM
></TD
><TD
>An instance of <FONT
COLOR="GREEN"
><CODE
>&#60;dump-buffer&#62;</CODE
></FONT
>. The in-memory buffer into which the object
	      should be dumped.</TD
></TR
></TABLE
></BLOCKQUOTE
><P
><STRONG
>Return Values</STRONG
></P
><BLOCKQUOTE
>None.</BLOCKQUOTE
><P
><STRONG
>Description</STRONG
></P
><BLOCKQUOTE
><P
>This routine is overloaded to dump individual types
	    objects. Methods for primitive Dylan types can be found in
	    <A
HREF="gdmaint-d2c-base.html#GDMAINT-D2C-BASE-DYLAN-DUMP"
>the section called <I
>The <FONT
COLOR="GREEN"
><CODE
>Dylan-Dump</CODE
></FONT
> Module</I
></A
>.</P
></BLOCKQUOTE
><TABLE
WIDTH="100%"
CELLPADDING="0"
BORDER="0"
><TR
><TD
><B
><FONT
COLOR="GREEN"
><CODE
>add-od-loader</CODE
></FONT
></B
></TD
><TD
ALIGN="RIGHT"
><STRONG
>[Function]</STRONG
></TD
></TR
></TABLE
><HR><BLOCKQUOTE
>Register a routine for reading a dumped object back
	  into memory.</BLOCKQUOTE
><P
><STRONG
>Synopsis</STRONG
></P
><BLOCKQUOTE
>add-od-loader (<EM
>dispatcher</EM
>, <EM
>name</EM
>, <EM
>func</EM
>) =&#62; ()</BLOCKQUOTE
><P
><STRONG
>Parameters</STRONG
></P
><BLOCKQUOTE
><TABLE
BORDER="0"
COLUMNSPACING="0"
><TR
><TD
VALIGN="TOP"
><EM
>dispatcher</EM
></TD
><TD
>An instance of <FONT
COLOR="GREEN"
><CODE
>&#60;dispatcher&#62;</CODE
></FONT
>. </TD
></TR
><TR
><TD
VALIGN="TOP"
><EM
>name</EM
></TD
><TD
>An instance of <FONT
COLOR="GREEN"
><CODE
>&#60;symbol&#62;</CODE
></FONT
>. </TD
></TR
><TR
><TD
VALIGN="TOP"
><EM
>func</EM
></TD
><TD
>An instance of <FONT
COLOR="GREEN"
><CODE
>&#60;function&#62;</CODE
></FONT
>. </TD
></TR
></TABLE
></BLOCKQUOTE
><P
><STRONG
>Return Values</STRONG
></P
><BLOCKQUOTE
>None.</BLOCKQUOTE
><P
><STRONG
>Description</STRONG
></P
><BLOCKQUOTE
><P
>This function is the &#8220;other half&#8221; of
	    <FONT
COLOR="GREEN"
><CODE
>dump-od</CODE
></FONT
>. It is called to register a routine for
	    reloading dumped objects.</P
></BLOCKQUOTE
><H2
><A
NAME="GDMAINT-D2C-BASE-DYLAN-DUMP"
>The <FONT
COLOR="GREEN"
><CODE
>Dylan-Dump</CODE
></FONT
> Module</A
></H2
><P
>This module provides ODF dumping and loading routines for all
	of the primitive types. </P
><H2
><A
NAME="GDMAINT-D2C-BASE-COMPILE-TIME-VALUES"
>The <FONT
COLOR="GREEN"
><CODE
>Compile-Time-Values</CODE
></FONT
> Module</A
></H2
><P
>This module exports <FONT
COLOR="GREEN"
><CODE
>&#60;ct-value&#62;</CODE
></FONT
>, which
	represents a value known at compile time. It also supplies
	<FONT
COLOR="GREEN"
><CODE
>&#60;literal&#62;</CODE
></FONT
> and a number of subclasses to represent
	literal strings, integers, lists and other primitive types.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-SOURCE"
>The <FONT
COLOR="GREEN"
><CODE
>Source</CODE
></FONT
> Module</A
></H2
><P
><B
CLASS="COMMAND"
>d2c</B
> was designed to fetch source records from several
	sources, including flat text files and eventaully code
	databases. To permit this flexibility, <B
CLASS="COMMAND"
>d2c</B
> uses a very abstract
	interface for representing locations in source code.</P
><P
>The <FONT
COLOR="GREEN"
><CODE
>&#60;source-location&#62;</CODE
></FONT
> class is an open,
	abstract class with no slots. All instances must provide a method
	for <FONT
COLOR="GREEN"
><CODE
>describe-source-location</CODE
></FONT
>.</P
><P
>The <FONT
COLOR="GREEN"
><CODE
>source-location</CODE
></FONT
> generic takes an arbitrary
	object as an argument and returns a source location. The mix-in
	class <FONT
COLOR="GREEN"
><CODE
>&#60;source-location-mixin&#62;</CODE
></FONT
> provides the
	init-keyword <FONT
COLOR="GREEN"
><CODE
>source-location:</CODE
></FONT
> and a method on
	<FONT
COLOR="GREEN"
><CODE
>source-location</CODE
></FONT
> which returns the value of the keyword
	or <FONT
COLOR="GREEN"
><CODE
>&#60;unknown-source-location&#62;</CODE
></FONT
>.</P
><P
>The <FONT
COLOR="GREEN"
><CODE
>&#60;source-file&#62;</CODE
></FONT
> class reads an entire
	input file into memory and provides access to the contents. It's
	tightly-coupled to the class
	<FONT
COLOR="GREEN"
><CODE
>&#60;file-source-location&#62;</CODE
></FONT
>, which represents a
	location within a source file. Separating these two classes is not
	feasible. Among other things, this code generates the attractive,
	multiline displays of exactly where an error occured.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-TOKENS"
>The <FONT
COLOR="GREEN"
><CODE
>Tokens</CODE
></FONT
> Module</A
></H2
><P
>This module provides classes and constants for representing
	tokens and syntax tables.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-HEADER"
>The <FONT
COLOR="GREEN"
><CODE
>Header</CODE
></FONT
> Module</A
></H2
><P
>Dylan source files have <SPAN
CLASS="ACRONYM"
>RFC</SPAN
> 822 headers,
	similar to those used by Internet e-mail and many other
	protocols. This module provides support for parsing headers at the
	top of a file and extracting the values of keywords. White space at
	the begining and ends of lines is removed automatically.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-PLATFORM"
>The <FONT
COLOR="GREEN"
><CODE
>Platform</CODE
></FONT
> Module</A
></H2
><P
>This module contains code to parse
	<TT
CLASS="FILENAME"
>platforms.descr</TT
>, which contains descriptions
	of the various host platforms supported by <B
CLASS="COMMAND"
>d2c</B
>. A description of
	each of the parameters appears in
	<TT
CLASS="FILENAME"
>platforms.descr</TT
> itself.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-ERRORS"
>The <FONT
COLOR="GREEN"
><CODE
>Errors</CODE
></FONT
> Module</A
></H2
><P
>This module exports a number of classes and functions related
	to compiler errors and warnings.</P
><H2
><A
NAME="GDMAINT-D2C-SIGNATURE"
>The <FONT
COLOR="GREEN"
><CODE
>Signature-Interface</CODE
></FONT
> and
	<FONT
COLOR="GREEN"
><CODE
>Signature</CODE
></FONT
> Modules</A
></H2
><P
>The <FONT
COLOR="GREEN"
><CODE
>Signature-Interface</CODE
></FONT
> module creates a
	group of names which are actually implemented in the
	<FONT
COLOR="GREEN"
><CODE
>Signature</CODE
></FONT
> module. These represent the formal
	parameter and result lists of a Dylan function.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-NAMES"
>The <FONT
COLOR="GREEN"
><CODE
>Names</CODE
></FONT
> Module</A
></H2
><P
>When reporting errors, <B
CLASS="COMMAND"
>d2c</B
> often needs to provide names for
	various functions, anonymous local methods and other things found
	in Dylan programs. This module knows about several different kinds
	of names and how they should be displayed to the user.</P
><P
>It does not appear that these classes are used in as part of
	the compiler's own computations. A quick look suggests that this is
	merely interface and debugging code.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-DEFINITIONS"
>The <FONT
COLOR="GREEN"
><CODE
>Definitions</CODE
></FONT
> Module</A
></H2
><P
>The top-of-file comment for this module reads:</P
><BLOCKQUOTE
><P
>Abstract class that all definitions inherit from.  A
          definition is the compilers handle on some run-time value.  In
          addition to the obvious things, definitions exist for things
          like the type of a variable (when it isn't a compile-time
          constant).</P
></BLOCKQUOTE
><P
>It appears that named, top-level forms each get a
	definition. From the comment, it sounds as if the following code
	produces two definitions:</P
><PRE
CLASS="PROGRAMLISTING"
>define variable foo :: run-time-expression() = #f;</PRE
><P
>One definition refers to the variable itself, and the other
	refers to the type value computed at initialization time. Is this a
	correct assumption?</P
><H2
><A
NAME="GDMAINT-D2C-BASE-VARIABLES"
>The <FONT
COLOR="GREEN"
><CODE
>Variables</CODE
></FONT
> Module</A
></H2
><P
>This module is in change of libraries, modules and
	namespaces.  It maintains the global table of libraries, processes
	the various clauses in <FONT
COLOR="GREEN"
><CODE
>define library</CODE
></FONT
> and <FONT
COLOR="GREEN"
><CODE
>define
	module</CODE
></FONT
>, and keeps track of where variable definitions
	live. The magic <FONT
COLOR="GREEN"
><CODE
>Dylan-User</CODE
></FONT
> modules get set up
	here as well.</P
><P
>Each <FONT
COLOR="GREEN"
><CODE
>&#60;variable&#62;</CODE
></FONT
> object also provides slots
	for the associated definition, transformers and constant
	evaluator. It would appear that this module defines some of the
	more important data structures in the compiler.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-POLICY"
>The <FONT
COLOR="GREEN"
><CODE
>Policy</CODE
></FONT
> Module</A
></H2
><P
>The <FONT
COLOR="GREEN"
><CODE
>Policy</CODE
></FONT
> represents an
	<I
CLASS="GLOSSTERM"
>optimization policy</I
>: a set of parameters
	used for making tradeoffs between speed, safety and code size. A
	quick inspection of the code shows that a
	<FONT
COLOR="GREEN"
><CODE
>&#60;policy&#62;</CODE
></FONT
> object will not survive the dumping and
	loading processes intact. Do these actually get used?</P
><H2
><A
NAME="GDMAINT-D2C-BASE-CTYPE"
>The <FONT
COLOR="GREEN"
><CODE
>CType</CODE
></FONT
> Module</A
></H2
><P
>This module contains lots of compile-time type functions,
	including type intesections, type unions and even type
	differences. Their exact role in the bigger scheme of things is
	still unclear.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-TRANSFORMERS"
>The <FONT
COLOR="GREEN"
><CODE
>Transformers</CODE
></FONT
> Module</A
></H2
><P
>Another mystery module. Transformers get attached to function
	definitions and do something complicated to &#8220;call
	operations&#8221;. Does this have anything to do with compile-time
	method dispatching?</P
><H2
><A
NAME="GDMAINT-D2C-BASE-REPRESENTATION"
>The <FONT
COLOR="GREEN"
><CODE
>Representation</CODE
></FONT
> Module</A
></H2
><P
>This module provides a very abstract interface for choosing
	data representations in generated code. It currently appears to be
	implemented by the <A
HREF="gdmaint-d2c-base.html#GDMAINT-D2C-BASE-C-REPRESENTATION"
>        <FONT
COLOR="GREEN"
><CODE
>C-Representation</CODE
></FONT
> module</A
>.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-CLASSES"
>The <FONT
COLOR="GREEN"
><CODE
>Classes</CODE
></FONT
> Module</A
></H2
><P
>This module contains the guts of the class system, which is
	implemented with classes as a subtype of
	<FONT
COLOR="GREEN"
><CODE
>&#60;ctype&#62;</CODE
></FONT
>. This module also computes class
	precedence lists, unique class IDs and slot layouts.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-TYPE-DUMP"
>The <FONT
COLOR="GREEN"
><CODE
>Type-Dump</CODE
></FONT
> Module</A
></H2
><P
>This is an implementation module which contains ODF support
	for various subclasses of <FONT
COLOR="GREEN"
><CODE
>&#60;ctype&#62;</CODE
></FONT
>.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-C-REPRESENTATION"
>The <FONT
COLOR="GREEN"
><CODE
>C-Representation</CODE
></FONT
> Module</A
></H2
><P
>This modules knows about the different C data types. It also
	knows about heap representations, direct representations and
	general representations.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-COMPILE-TIME-FUNCTIONS"
>The <FONT
COLOR="GREEN"
><CODE
>Compile-Time-Functions</CODE
></FONT
> Module</A
></H2
><P
>From the top-of-file comment:</P
><BLOCKQUOTE
><P
>A ct-function is a kind of compile-time value used to
          represent a function. ct-functions contain various
          linkage-related information needed to call the function, but
          don't reference the FER for the function (e.g. the
          &#60;function-literal&#62;.)  This information is used both by the
          backend and by the heap builder.</P
></BLOCKQUOTE
><P
>This is also where Peter Housel added the support for
	callback functions. This module includes support for
	<I
CLASS="GLOSSTERM"
>general entries</I
> and <I
CLASS="GLOSSTERM"
>generic
	entries</I
>, which are presumably the type-checked and
	dispatched entry points for functions, respectively.</P
><H2
><A
NAME="GDMAINT-D2C-BASE-FLOW"
>The <FONT
COLOR="GREEN"
><CODE
>Flow</CODE
></FONT
> Module</A
></H2
><P
>This module provides classes representing block-level control
	flow within a function. You should be able to find information on
	this subject in any good compiler textbook.</P
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="gdmaint-d2c-internals.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="gdmaint.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="gdmaint-d2c-parser.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><B
CLASS="COMMAND"
>d2c</B
> Internals Guide</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="gdmaint-d2c-internals.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Parser</CODE
></FONT
> Library</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>