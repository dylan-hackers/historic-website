<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Convert</CODE
></FONT
> Library</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.13"><LINK
REL="HOME"
TITLE="Gwydion Dylan Porting and Maintenance Guide"
HREF="gdmaint.html"><LINK
REL="UP"
TITLE="d2c Internals Guide"
HREF="gdmaint-d2c-internals.html"><LINK
REL="PREVIOUS"
TITLE="The Compiler-Front Library"
HREF="gdmaint-d2c-front.html"><LINK
REL="NEXT"
TITLE="The Compiler-Optimize Library"
HREF="gdmaint-d2c-optimize.html"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Gwydion Dylan Porting and Maintenance Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="gdmaint-d2c-front.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. <B
CLASS="COMMAND"
>d2c</B
> Internals Guide</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="gdmaint-d2c-optimize.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="GDMAINT-D2C-CONVERT"
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Convert</CODE
></FONT
> Library</A
></H1
><P
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Convert</CODE
></FONT
> library acts as an
      adaptor between the <A
HREF="gdmaint-d2c-parser.html"
><FONT
COLOR="GREEN"
><CODE
>Compiler-Parser</CODE
></FONT
>
    library</A
> and the <A
HREF="gdmaint-d2c-front.html"
><FONT
COLOR="GREEN"
><CODE
>Compiler-Front</CODE
></FONT
>
    library</A
>.</P
><P
>As a rule of thumb, <FONT
COLOR="GREEN"
><CODE
>Compiler-Convert</CODE
></FONT
>
      implements those parts of the front end which know about the
      output of the parser.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-LEXENV"
>The <FONT
COLOR="GREEN"
><CODE
>LexEnv</CODE
></FONT
> Module</A
></H2
><P
>This module implements <I
CLASS="GLOSSTERM"
>lexical
	environments</I
> (a formal term for &#8220;local
	namespaces&#8221;). This is the code that associates variable
	names with the correct bindings.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-COMPILE-TIME-EVAL"
>The <FONT
COLOR="GREEN"
><CODE
>Compile-Time-Eval</CODE
></FONT
> Module</A
></H2
><P
>This module performs compile-time evaluation of constant
	expressions. It operates on the parsed representation of a Dylan
	program, not the front-end representation.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-EXPANDERS"
>The <FONT
COLOR="GREEN"
><CODE
>Expanders</CODE
></FONT
> Module</A
></H2
><P
>This module contains <A
HREF="gdmaint-d2c-parser.html#GDMAINT-D2C-PARSER-MACROS"
>procedural macro
	expanders</A
> for basic, built-in macros such as
	<FONT
COLOR="GREEN"
><CODE
>make-if</CODE
></FONT
>.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-FER-CONVERT"
>The <FONT
COLOR="GREEN"
><CODE
>FER-Convert</CODE
></FONT
> Module</A
></H2
><P
>This module processes chunks of the parse tree and uses the
	<A
HREF="gdmaint-d2c-front.html#GDMAINT-D2C-FRONT-BUILDER-INTERFACE"
>        <FONT
COLOR="GREEN"
><CODE
>&#60;fer-builder&#62;</CODE
></FONT
></A
> to produce the front-end
        representation.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-ABOUT-TOP-LEVEL"
>Processing of Top-Level Definitions</A
></H2
><P
>The code to process top-level definitions is spread across
	several libraries. Most of the machinery actually lives here in the
	<FONT
COLOR="GREEN"
><CODE
>Compiler-Convert</CODE
></FONT
> library.</P
><P
>Each top-level form must define methods on three generic
	functions:</P
><P
></P
><DL
><DT
><FONT
COLOR="GREEN"
><CODE
>process-top-level-form</CODE
></FONT
></DT
><DD
><P
>When the parser finishes with a top-level form, it
	      passes the form to this function, which produces the final
	      parse tree and creates an object representing the top-level
              form. (See <A
HREF="gdmaint-d2c-parser.html#GDMAINT-D2C-PARSER-PARSER"
>the section called <I
>The <FONT
COLOR="GREEN"
><CODE
>Parser</CODE
></FONT
> Module</I
></A
>.)</P
></DD
><DT
><FONT
COLOR="GREEN"
><CODE
>finalize-top-level-form</CODE
></FONT
></DT
><DD
><P
>This function is called by the compilation driver when
	      all the top-level forms have been parsed. It's used to
	      implement various kinds of foward references within a
	      module.
              (See <A
HREF="gdmaint-d2c-front.html#GDMAINT-D2C-FRONT-TOP-LEVEL-FORMS"
>the section called <I
>The <FONT
COLOR="GREEN"
><CODE
>Top-Level-Forms</CODE
></FONT
> Module</I
></A
>.)</P
></DD
><DT
><FONT
COLOR="GREEN"
><CODE
>convert-top-level-form</CODE
></FONT
></DT
><DD
><P
>Once a top-level form has been processed and finalized,
              it can be converted to the appropriate front-end
              representation. Methods on this function use the
              <FONT
COLOR="GREEN"
><CODE
>&#60;fer-builder&#62;</CODE
></FONT
> interface. (See <A
HREF="gdmaint-d2c-front.html#GDMAINT-D2C-FRONT-TOP-LEVEL-FORMS"
>the section called <I
>The <FONT
COLOR="GREEN"
><CODE
>Top-Level-Forms</CODE
></FONT
> Module</I
></A
> and <A
HREF="gdmaint-d2c-front.html#GDMAINT-D2C-FRONT-BUILDER-INTERFACE"
>the section called <I
>The <FONT
COLOR="GREEN"
><CODE
>Builder-Interface</CODE
></FONT
> Module</I
></A
>.)</P
></DD
></DL
><P
>Generally speaking, the parsed representation of a built-in
	<FONT
COLOR="GREEN"
><CODE
>define foo</CODE
></FONT
> form would be named
	<FONT
COLOR="GREEN"
><CODE
>&#60;define-foo-parse&#62;</CODE
></FONT
>. The object representing the
	top-level form itself would be named
	<FONT
COLOR="GREEN"
><CODE
>&#60;define-foo-tlf&#62;</CODE
></FONT
>. There's also a
	<FONT
COLOR="GREEN"
><CODE
>&#60;foo-definition&#62;</CODE
></FONT
> floating around in most cases.
	The relationships between these three representations need to be
	documented.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-DEFINE-MACROS"
>The <FONT
COLOR="GREEN"
><CODE
>Define-Macros</CODE
></FONT
> Module</A
></H2
><P
>This module handles <FONT
COLOR="GREEN"
><CODE
>define macro</CODE
></FONT
> forms and
	<I
CLASS="GLOSSTERM"
>macro calls</I
> which appear at the top
	level.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-DEFINE-LIBRARIES-AND-MODULES"
>The <FONT
COLOR="GREEN"
><CODE
>Define-Libraries-and-Modules</CODE
></FONT
>
	Module</A
></H2
><P
>This module handles <FONT
COLOR="GREEN"
><CODE
>define library</CODE
></FONT
> and
	<FONT
COLOR="GREEN"
><CODE
>define module</CODE
></FONT
> forms.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-DEFINE-FUNCTIONS"
>The <FONT
COLOR="GREEN"
><CODE
>Define-Functions</CODE
></FONT
> Module</A
></H2
><P
>This module handles <FONT
COLOR="GREEN"
><CODE
>define generic</CODE
></FONT
> and
	<FONT
COLOR="GREEN"
><CODE
>define method</CODE
></FONT
> forms. (<FONT
COLOR="GREEN"
><CODE
>define function</CODE
></FONT
>
	forms are expanded by a macro defined in the runtime library.) Most
	of the logic for <I
CLASS="GLOSSTERM"
>implicit generic functions</I
>
	lives here.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-DEFINE-CONSTANTS-AND-VARIABLES"
>The <FONT
COLOR="GREEN"
><CODE
>Define-Constants-and-Variables</CODE
></FONT
>
	Module</A
></H2
><P
>This module handles <FONT
COLOR="GREEN"
><CODE
>define generic</CODE
></FONT
> and
	<FONT
COLOR="GREEN"
><CODE
>define method</CODE
></FONT
> forms. It also includes code for
	<I
CLASS="GLOSSTERM"
>constant methods</I
>, which may get used in a
	few strange places. More research is needed here.</P
><P
>This module contains an alarming number of &#8220;shouldn't
	happen&#8221; errors. Is this left-over code, safety checks for a
	fragile area of the compiler, or evidence of some fundamental
	confusion about what's going on?</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-DEFINE-CLASSES"
>The <FONT
COLOR="GREEN"
><CODE
>Define-Classes</CODE
></FONT
> Module</A
></H2
><P
>This library handles <FONT
COLOR="GREEN"
><CODE
>define class</CODE
></FONT
> forms. There's
	a lot in here, including <A
HREF="gdmaint-d2c-base.html#GDMAINT-D2C-BASE-CTYPE"
><I
CLASS="GLOSSTERM"
>ctype</I
>
	calculation</A
> for classes and creation of getter and setter
	methods. It's not immediately clear how this relates to the code in
	<A
HREF="gdmaint-d2c-base.html#GDMAINT-D2C-BASE-CLASSES"
>the module
	<FONT
COLOR="GREEN"
><CODE
>Classes</CODE
></FONT
></A
>.</P
><H2
><A
NAME="GDMAINT-D2C-CONVERT-TOP-LEVEL-EXPRESSIONS"
>The <FONT
COLOR="GREEN"
><CODE
>Top-Level-Expressions</CODE
></FONT
> Module</A
></H2
><P
>This module handles actual code appearing at the top
	level. There's also something going on with
	<FONT
COLOR="GREEN"
><CODE
>&#60;magic-interal-primitives-placeholder&#62;</CODE
></FONT
>, which is
	(of course) excessively magic. If you're the sort of person who
	likes to figure out how magicians do their tricks, feel free to
	figure this out for the rest of us.</P
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="gdmaint-d2c-front.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="gdmaint.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="gdmaint-d2c-optimize.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Front</CODE
></FONT
> Library</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="gdmaint-d2c-internals.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>The <FONT
COLOR="GREEN"
><CODE
>Compiler-Optimize</CODE
></FONT
> Library</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>