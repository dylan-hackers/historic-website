<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Streams, growing sequences, and object identity</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.13"><LINK
REL="HOME"
TITLE="Gwydion Dylan Library Reference Guide"
HREF="gdlibs.html"><LINK
REL="UP"
TITLE="The Streams Library"
HREF="libs-streams.html"><LINK
REL="PREVIOUS"
TITLE="Concepts"
HREF="streams-concepts.html"><LINK
REL="NEXT"
TITLE="Stream classes"
HREF="streams-stream-classes.html"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Gwydion Dylan Library Reference Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="streams-concepts.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 3. The Streams Library</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="streams-stream-classes.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="STREAMS-GROWING-SEQUENCES"
>Streams, growing sequences, and object identity</A
></H1
><P
>When writing to output streams over sequences, Dylan may
      from time to time need to grow the underlying sequence that it
      is using to represent the stream data. </P
><P
>Consider the example of an output stream instantiated over
      an empty string. As soon as a write operation is performed on
      the stream, it is necessary to replace the string object used in
      the representation of the string stream. As well as incurring
      the cost of creating a new string, the replacement operation can
      affect the integrity of other references to the string within
      the program. </P
><P
>To guarantee that alias references to a sequence used in
      an output <TT
CLASS="CLASSNAME"
>&#60;sequence-stream&#62;</TT
> will
      have access to any elements written to the sequence via the
      stream, supply a <TT
CLASS="CLASSNAME"
>&#60;stretchy-vector&#62;</TT
>
      to make. A stream over a stretchy vector will use the same
      stretchy vector throughout the stream's existence. </P
><P
>For example:</P
><PRE
CLASS="PROGRAMLISTING"
>let sv = make(&#60;stretchy-vector&#62;);
let stream = make(&#60;sequence-stream&#62;, 
                  contents: sv, 
                  direction: #"output");
write(stream, #(1, 2, 3, 4, 5, 6, 7, 8, 9));
write(stream, "ABCDEF");
values(sv, stream-contents(stream));</PRE
><P
>The example returns two values. Each value is the same
      (<TT
CLASS="LITERAL"
>\==</TT
>) stretchy vector:</P
><PRE
CLASS="PROGRAMLISTING"
>#[1, 2, 3, 4, 5, 6, 7, 8, 9, 'A', 'B', 'C', 'D', 'E', 'F']</PRE
><P
>If a stretchy vector is not supplied, the result is
      different: </P
><PRE
CLASS="PROGRAMLISTING"
>let v = make(&#60;vector&#62;, size: 5);
let stream = make(&#60;sequence-stream&#62;,
                  contents: v, 
                  direction: #"output");
write(stream, #(1, 2, 3, 4, 5, 6, 7, 8, 9));
write(stream, "ABCDEF");
values(v, stream-contents(stream));</PRE
><P
>This example returns as its first value the original
      vector, whose contents are undefined, but the second value is a
      new vector:</P
><PRE
CLASS="PROGRAMLISTING"
>#[1, 2, 3, 4, 5, 6, 7, 8, 9, 'A', 'B', 'C', 'D', 'E', 'F']</PRE
><P
>This difference arises because the output stream in the
      second example does not use a stretchy vector to hold the stream
      data. A vector of at least 15 elements is necessary to
      accommodate the elements written to the stream, but the vector
      supplied, <TT
CLASS="LITERAL"
>v</TT
>, can hold only 5. Since the
      stream cannot change <TT
CLASS="LITERAL"
>v</TT
>'s size, it must
      allocate a new vector each time it grows. </P
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="streams-concepts.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="gdlibs.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="streams-stream-classes.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Concepts</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="libs-streams.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Stream classes</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>