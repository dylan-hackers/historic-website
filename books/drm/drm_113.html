<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  
  <!-- Relative Navigation -->
  
  <link rel="up" href="drm_110.html" />
  <link rel="prev" href="drm_112.html" />
  <link rel="next" href="drm_114.html" />
  
  <!-- Absolute Navigation -->
  
  <link rel="top" href="drm_1.html" />
  <link rel="start first" href="index.html" />
  <link rel="contents" href="drm_2.html" />
  <link rel="copyright" href="drm_3.html" />
  <link rel="glossary" href="drm_126.html" />
  <link rel="index" href="drm_127.html" />
  <link rel="last author" href="drm_128.html" />
  
  <!-- Chapters -->
  
  <link rel="chapter" title="About This Book" href="drm_4.html" />
  <link rel="chapter" title="1 Introduction" href="drm_5.html" />
  <link rel="chapter" title="2 Syntax" href="drm_9.html" />
  <link rel="chapter" title="3 Program Structure" href="drm_25.html" />
  <link rel="chapter" title="4 Program Control" href="drm_28.html" />
  <link rel="chapter" title="5 Types and Classes" href="drm_38.html" />
  <link rel="chapter" title="6 Functions" href="drm_47.html" />
  <link rel="chapter" title="7 Conditions" href="drm_52.html" />
  <link rel="chapter" title="8 Collections" href="drm_59.html" />
  <link rel="chapter" title="9 Sealing" href="drm_70.html" />
  <link rel="chapter" title="10 Macros" href="drm_76.html" />
  <link rel="chapter" title="11 The Built-In Classes" href="drm_87.html" />
  <link rel="chapter" title="12 The Built-In Functions" href="drm_96.html" />
  <link rel="chapter" title="13 Other Built-In Objects" href="drm_108.html" />
  <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="drm_110.html" />
  
  <!-- Appendices -->
  
  <link rel="appendix" title="A BNF" href="drm_116.html" />
  <link rel="appendix" title="B Exported Names" href="drm_119.html" />
  
  <!-- Stylesheet -->
  
  <link title="main style sheet" rel="stylesheet" href="drm.css" type="text/css" />

  <title>The Dylan Reference Manual: Local Declarations</title>
</head>
<body>

<div class="wm-div-body">
<a name="HEADING113"></a>

<div class="wm-div-headers">
<p id="navigation"><a href="drm_112.html"><img alt="prev" src="prev.gif" title="Go to previous page" /></a> <a href="drm_114.html"><img alt="next" src="next.gif" title="Go to next page" /></a> <a href="drm_110.html"><img alt="up" src="up.gif" /></a> <a href="drm_1.html"><img alt="top" src="top.gif" /></a> <a href="drm_2.html"><img alt="Contents" src="content.gif" /></a> <a href="drm_127.html"><img alt="index" src="index.gif" /></a></p>

<div id="section-header">
  <p id="section-prefix">Chapter 14</p>
  <p id="section-name">The Built-In Macros and Special Definitions</p>
</div>

<div class="wm-div-toc">
  <ul class="page-toc">
    <li><a href="drm_113.html#HEADING113-63"><code>let</code> <span class="attributes-summary">[Local Declaration]</span></a></li>
    <li><a href="drm_113.html#HEADING113-79"><code>local</code> <span class="attributes-summary">[Local Declaration]</span></a></li>
    <li><a href="drm_113.html#HEADING113-89"><code>let handler</code> <span class="attributes-summary">[Local Declaration]</span></a></li>
  </ul>
</div>

<hr />

</div>

<a name="HEADING113-0"></a>
<a name="UID-Built-In_Macros-7985"></a>
<h1 class="H1.Heading1">Local Declarations</h1>
<p class="T1.Text1"><a name="MARKER-2-2029"></a>Local declarations are used to create bindings or install handlers that are active for the remainder of the innermost body containing the declaration. Bindings created by local declarations can be referenced only in the remaining program text of the body. Handlers installed are active while the execution of the remainder of the body is active, which includes the time during which any functions called from the remainder of the body are active.</p>
<table class="numbered"><caption><strong>Table 14-2</strong>  Local Declarations</caption>
<tr><th class="primary"><p class="TbH.TblHd"> Macro</p>
</th><th><p class="TbH.TblHd"> Description</p>
</th><th><p class="TbH.TblHd"> Page</p>
</th></tr><tr><td><p class="TbT.TblText"> <code>let</code></p>
</td><td><p class="TbT.TblText"> <a href="#MARKER-9-2031" class="TbT.TblText">Creates and initializes new local bindings within the smallest enclosing implicit body.</a></p>
</td><td><p class="TbT.TblText"> <a href="#MARKER-9-2031" class="TbT.TblText">390</a></p>
</td></tr><tr><td><p class="TbT.TblText"> <code>local</code></p>
</td><td><p class="TbT.TblText"> <a href="#MARKER-9-2035" class="TbT.TblText">Creates new local bindings within the smallest enclosing implicit body and initializes them to local methods that can be self-recursive and mutually recursive.</a></p>
</td><td><p class="TbT.TblText"> <a href="#MARKER-9-2035" class="TbT.TblText">391</a></p>
</td></tr><tr><td><p class="TbT.TblText"> <code>let handler</code></p>
</td><td><p class="TbT.TblText"> <a href="#MARKER-9-2038" class="TbT.TblText">Establishes a condition handler for the duration of the execution of smallest enclosing implicit body.</a></p>
</td><td><p class="TbT.TblText"> <a href="#MARKER-9-2038" class="TbT.TblText">392</a></p>
</td></tr></table><a name="HEADING113-63"></a>
<h3 class="H4.Heading4"><code><a name="MARKER-2-2030"></a>let</code> <span class="attributes-summary">[Local Declaration]</span></h3>
<hr class="H4.Heading4" />
<p class="SD.ShortDescription"><a name="MARKER-9-2031"></a>Creates and initializes new local bindings within the smallest enclosing implicit body.</p>
<dl class="Cliche">
  <dt class="Cliche">Macro Call:</dt>
  <dd class="Cliche"><p class="Cliche"> <code>let <var>variables</var> = <var>init</var> ;</code></p></dd>
  <dt class="Cliche">Arguments:</dt>
  <dd class="Cliche">
    <dl>
      <dt><var>variables</var></dt>
      <dd>
        <p class="Cliche"><span class="BNF">variable<em class="BNF"><sub>bnf</sub></em></span> <strong class="re">|</strong> <code>(</code> <span class="BNF">variable-list<em class="BNF"><sub>bnf</sub></em></span> <code>)</code></p>
      </dd>
      <dt class="RP.RoutineParam"><var>init</var></dt>
      <dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
  </dl></dd>
  <dt class="Cliche">Description:</dt>
  <dd class="Cliche"><p class="Cliche"> <code>let</code> creates local bindings for the <var>variables</var>, and initializes them to the values returned by <var>init</var>. The bindings are visible for the remainder of the smallest enclosing implicit body.</p>
    <p class="T1.Text1"><a name="MARKER-2-2032"></a>The first value returned by the <var>init</var> is bound to the first <var>variable</var>, the second value to the second <var>variable</var>, etc. The last <var>variable</var> may be preceded by <code>#rest</code>, in which case it is bound to a sequence containing all the remaining values.</p>
    <p class="T1.Text1">Each <var>variable</var> is a variable-name or a variable-name followed by a specializer.</p>
    <p class="T1.Text1">If more than one binding is defined, the <var>variables</var> are enclosed in parentheses and separated by commas.</p>
    <pre class="Cv.Code">
let start = 0;

let (whole-part, remainder) = truncate(amount);

let (first-value, #rest rest-values) = get-initial-values();</pre>
    <p class="T1.Text1"><a name="MARKER-2-2033"></a>Local variables may be specialized. This ensures that their value will always be of a given type. An attempt to initialize or assign the variable to a value not of that type will signal an error of type <code>&lt;type-error&gt;</code>.</p>
    <pre class="Cv.Code">
let elapsed-time :: &lt;integer&gt; = 0;

let the-front-window :: &lt;window&gt; = front-window();

let(whole-part :: &lt;integer&gt;, remainder :: &lt;real&gt;) = truncate(amount);</pre>
  </dd>
</dl>
<a name="HEADING113-79"></a>
<h3 class="H4.Heading4"><code><a name="MARKER-2-2034"></a>local</code> <span class="attributes-summary">[Local Declaration]</span></h3>
<hr class="H4.Heading4" />
<p class="SD.ShortDescription"><a name="MARKER-9-2035"></a><a name="MARKER-2-2036"></a>Creates new local bindings within the smallest enclosing implicit body and initializes them to local methods that can be self-recursive and mutually recursive.</p>
<dl class="Cliche">
<dt class="Cliche">Macro Call:</dt>
<dd class="Cliche"><p class="Cliche"> <code>local</code> <strong class="re">{ [</strong> <code>method</code> <strong class="re">]</strong> <var>name parameter-list</var> <strong class="re">[</strong> <var>body</var> <strong class="re">]</strong> <code>end</code> <strong class="re">[</strong> <code>method</code> <strong class="re">] [</strong> <var>name</var> <strong class="re">] }</strong> <code>,</code><strong class="re"><sup>+</sup></strong></p></dd>
<dt class="Cliche">Arguments:</dt>
<dd class="Cliche">
    <dl>
      <dt><var>name</var></dt>
      <dd>
        <p class="Cliche"><span class="BNF">variable-name<em class="BNF"><sub>bnf</sub></em></span></p>
      </dd>
<dt class="RP.RoutineParam"><i class="parameter RP.RoutineParam">parameter-list<code></code></i></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> parameter-list<em class="RP.RoutineParam"><sub>bnf</sub></em></p></dd>
<dt class="RP.RoutineParam"><var>body</var></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <span class="BNF">body<em class="BNF"><sub>bnf</sub></em></span></p></dd>
</dl></dd>
<dt class="Cliche">Description:</dt>
<dd class="Cliche"><p class="Cliche"> <code>local</code> creates local methods that may be mutually recursive and self-recursive.</p>
<p class="T1.Text1">Each <var>name</var> creates a new local binding. The binding is initialized to a new method specified by the <var>parameter-list</var> and <var>body</var>. In addition to being visible for the remainder of the smallest enclosing implicit body, the bindings created for the <var>names</var> are visible to the <var>parameter-lists</var> and <var>bodies</var> of all the methods created by the <code>local</code> declaration.</p>
<p class="T1.Text1">The <var>parameter-list</var> is a standard method parameter list. A complete description of parameter lists is given in <a href="drm_49.html#MARKER-9-782" class="T1.Text1">"Parameter Lists" on page 84</a>.</p>
<p class="T1.Text1">The <var>body</var> is an implicit body.</p></dd>
</dl>
<a name="HEADING113-89"></a>
<h3 class="H4.Heading4"><code><a name="MARKER-2-2037"></a>let handler</code> <span class="attributes-summary">[Local Declaration]</span></h3>
<hr class="H4.Heading4" />
<p class="SD.ShortDescription"><code><a name="MARKER-9-2038"></a><a name="MARKER-2-2039"></a></code>Establishes a condition handler for the duration of the execution of smallest enclosing implicit body.</p>
<dl class="Cliche">
<dt class="Cliche">Macro Call:</dt>
<dd class="Cliche"><p class="Cliche"> <code>let handler</code> <i class="parameter Cliche">condition<code> = handler</code></i></p></dd>
<dt class="Cliche">Arguments:</dt>
<dd class="Cliche">
    <dl>
      <dt><var>condition</var></dt>
      <dd>
        <p class="Cliche"><var>type</var> <strong class="re">|</strong> <code>(</code> <var>type</var> <strong class="re">{</strong> <code>,</code> <var>option</var> <strong class="re">}*</strong> <code>)</code></p>
      </dd>
<dt class="RP.RoutineParam"><var>type</var></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
<dt class="RP.RoutineParam"><var>option</var></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <var>test-option</var> <strong class="re">|</strong> <var>init-option</var></p></dd>
<dt class="RP.RoutineParam"><var>test-option</var></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <code>test:</code> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
<dt class="RP.RoutineParam"><var>init-option</var></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <code>init-arguments:</code> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
<dt class="RP.RoutineParam"><var>handler</var></dt>
<dd class="RP.RoutineParam"><p class="RP.RoutineParam"> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
</dl></dd>
<dt class="Cliche">Description:</dt>
<dd class="Cliche"><p class="Cliche"> <code>let handler</code> establishes a new condition handler that is in effect for the duration of the execution of the remainder of the smallest enclosing implicit body. Unlike the local declarations <code>let</code> and <code>local</code>, <code>let handler</code> does not create any bindings.</p>
  <ul class="B1.Bullet1">
    <li class="B1.Bullet1">The <var>condition</var> describes the conditions for which the handler is applicable.
      <ul class="B2.Bullet2">
	<li class="B2.Bullet2">The <var>type</var> is the type of the applicable conditions. The handler will be applicable to conditions that are general instances of <var>type</var>.</li>
	<li class="B2.Bullet2">The <var>test-option </var> is a function that is called to further test the applicability of the handler. When a condition of type <var>type</var> is signaled, the test function will be called with that condition as an argument. If the test returns true, the handler is considered applicable to the condition. If the test returns false, the handler is considered to be inapplicable to the condition. The default value of this option is a function that always returns true. There can be at most one <var>test-option</var>.<br /><br />An example use for this feature is a restart handler for restarting only from a particular condition object, for example restarting from an unbound-slot error by setting the slot and retrying the invocation of the accessor. The <code>&lt;set-and-continue&gt;</code> restart condition will have the signaled <code>&lt;unbound-slot&gt;</code> condition in a slot, and the handler's test will check for it. (These class names are invented for this example and are not part of the specification.)</li>
	<li class="B2.Bullet2">The <var>init-option</var> is a sequence of alternating keywords and objects that can be used as initialization arguments to construct a condition to which the handler is applicable. For example, if the handler is a restart handler, a program could retrieve the <var>init-option</var> by calling <code>do-handlers</code>, and could then use them to construct a corresponding restart. There can be at most one <var>init-option</var>. <var>init-option</var> defaults to an empty sequence.</li>
      </ul>
    </li>
    <li class="B1.Bullet1">The<var> handler</var> is function called to handle a condition that matches <var>type</var> and passes <var>test-option</var>. The function should accept two arguments. The first argument will be the condition being signaled, and the second argument will be a next-handler function. The handler handles the condition by taking a nonlocal exit, returning values according to the condition's recovery protocol, or tail-recursively calling <code>signal</code> of a restart. The function can decline to handle the condition by tail-recursively calling the next-handler function with no arguments.</li>
  </ul>
  <p class="T1.Text1"><var>test-option</var> and <var>handler</var>  are distinct so that handler applicability can be tested without actually handling (which might take a nonlocal exit). One use for this is constructing a list of available restart handlers.</p>
  <p class="T1.Text1">There is no "condition wall," i.e., when executing <var>handler </var> the set of available handlers is not reset to the handlers that were in effect when the <code>let handler</code> was entered.</p>
  <p class="T1.Text1"> Implementations are encouraged to implement <code>let handler</code> in a way that optimizes establishing a handler for both speed and space, even if that increases the cost of signaling. The assumption is that most of the time a handler will never be used, because the exception it is looking for will never occur.</p>
  <p class="T1.Text1"><var>type</var>, <var>handler</var>, <var>test-option</var>, and <var>init-option</var> are executed before execution of the rest of the enclosing body begins.<a name="MARKER-2-2040"></a></p>
</dd>
</dl>

</div>

<div class="wm-div-footers">

<hr class="footer" />
<address class="footer">The Dylan Reference Manual - 7 Apr 1998</address>
<p class="footer"><a href="drm_112.html"><img alt="prev" src="prev.gif" title="Go to previous page" /></a> <a href="drm_114.html"><img alt="next" src="next.gif" title="Go to next page" /></a> <a href="drm_110.html"><img alt="up" src="up.gif" /></a> <a href="drm_1.html"><img alt="top" src="top.gif" /></a> <a href="drm_2.html"><img alt="Contents" src="content.gif" /></a> <a href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
<p class="footer">Copyright Apple Computer, Inc. 1996. Apple&#174; and the Apple logo are registered trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
<p class="footer">Generated with <a href="http://www.harlequin.com/webmaker" class="footer">Harlequin WebMaker&#174;</a></p>

</div>
</body>
</html>
