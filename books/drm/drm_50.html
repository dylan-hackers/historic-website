<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  
  <!-- Relative Navigation -->
  
  <link rel="up" href="drm_47.html" />
  <link rel="prev" href="drm_49.html" />
  <link rel="next" href="drm_51.html" />
  
  <!-- Absolute Navigation -->
  
  <link rel="top" href="drm_1.html" />
  <link rel="start first" href="index.html" />
  <link rel="copyright" href="drm_2.html" />
  <link rel="contents" href="drm_3.html" />
  <link rel="glossary" href="drm_126.html" />
  <link rel="index" href="drm_127.html" />
  <link rel="last author" href="drm_128.html" />
  
  <!-- Chapters -->
  
  <link rel="chapter" title="About This Book" href="drm_4.html" />
  <link rel="chapter" title="1 Introduction" href="drm_5.html" />
  <link rel="chapter" title="2 Syntax" href="drm_9.html" />
  <link rel="chapter" title="3 Program Structure" href="drm_25.html" />
  <link rel="chapter" title="4 Program Control" href="drm_28.html" />
  <link rel="chapter" title="5 Types and Classes" href="drm_38.html" />
  <link rel="chapter" title="6 Functions" href="drm_47.html" />
  <link rel="chapter" title="7 Conditions" href="drm_52.html" />
  <link rel="chapter" title="8 Collections" href="drm_59.html" />
  <link rel="chapter" title="9 Sealing" href="drm_70.html" />
  <link rel="chapter" title="10 Macros" href="drm_76.html" />
  <link rel="chapter" title="11 The Built-In Classes" href="drm_87.html" />
  <link rel="chapter" title="12 The Built-In Functions" href="drm_96.html" />
  <link rel="chapter" title="13 Other Built-In Objects" href="drm_108.html" />
  <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="drm_110.html" />
  
  <!-- Appendices -->
  
  <link rel="appendix" title="A BNF" href="drm_116.html" />
  <link rel="appendix" title="B Exported Names" href="drm_119.html" />
  
  <!-- Stylesheet -->
  
  <link rel="stylesheet" href="drm.css" type="text/css" />

  <title>Method Dispatch &mdash; 6. Functions &mdash; The DRM</title>
</head>
<body>

<div id="header">
<div id="navigation-header">
    <p id="book-title">The Dylan Reference Manual</p>
    <p id="basic-navigation"><a class="previous" title="Go to previous page" href="drm_49.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_51.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_47.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
  </div>

<div id="section-header">
  <p id="section-prefix">Chapter 6</p>
  <p id="section-name">Functions</p>
</div>

<div id="navigation-TOC">
  <ul class="front-matter">
    <li><a href="drm_1.html">Start</a></li>
    <li><a href="drm_3.html">Contents</a></li>
    <li><a href="drm_4.html">About This Book</a></li>
  </ul>
  <ol class="chapters">
    <li><a href="drm_5.html">Introduction</a></li>
    <li><a href="drm_9.html">Syntax</a></li>
    <li><a href="drm_25.html">Program Structure</a></li>
    <li><a href="drm_28.html">Program Control</a></li>
    <li><a href="drm_38.html">Types and Classes</a></li>
    <li><a href="drm_47.html">Functions</a>
      <ul>
	<li><a href="drm_48.html">Overview</a></li>
	<li><a href="drm_49.html">Parameter Lists</a></li>
	<li id="current">Method Dispatch
	  <ul>
	    <li><a href="#HEADING50-32">Calling Less Specific Methods</a></li>
	  </ul>
	</li>
	<li><a href="drm_51.html">Operations on Functions</a></li>
      </ul>
    </li>
    <li><a href="drm_52.html">Conditions</a></li>
    <li><a href="drm_59.html">Collections</a></li>
    <li><a href="drm_70.html">Sealing</a></li>
    <li><a href="drm_76.html">Macros</a></li>
    <li><a href="drm_87.html">The Built-In Classes</a></li>
    <li><a href="drm_96.html">The Built-In Functions</a></li>
    <li><a href="drm_108.html">Other Built-In Objects</a></li>
    <li><a href="drm_110.html">The Built-In Macros and Special Definitions</a></li>
  </ol>
  <ol class="appendices">
    <li><a href="drm_116.html">BNF</a></li>
    <li><a href="drm_119.html">Exported Names</a></li>
  </ol>
  <ul class="back-matter">
    <li><a href="drm_126.html">Glossary</a></li>
    <li><a href="drm_127.html">Index</a></li>
    <li><a href="drm_128.html">Colophon</a></li>
  </ul>
  <ul class="errata">
    <li><a href="drm_errata.html">Errata</a></li>
  </ul>
</div>

<hr />

</div>

<div id="content">
<a name="HEADING50-0"></a>
<a name="UID-Functions-2196"></a>
<h1 class="section-title"><a name="MARKER-9-844"></a>Method Dispatch</h1>
<p class="T1.Text1"><a name="MARKER-2-845"></a>When a <a name="MARKER-2-846"></a>generic function is called, the generic function uses the types of the arguments to determine which methods to call. This process is called <dfn>method dispatch</dfn>.</p>
<p class="T1.Text1">Method dispatch occurs in three phases. First, all the <a name="MARKER-2-847"></a><a name="MARKER-2-848"></a>applicable methods are selected. Next, the applicable methods are sorted by specificity. Finally, the most specific method is called.</p>
<a name="HEADING50-3"></a>
<h3 class="sub-subsection-title"><a name="MARKER-9-849"></a>Method Specificity</h3>
<p class="T1.Text1"><a name="MARKER-2-850"></a>For any two methods <var>A</var> and <var>B</var> that are applicable to a given generic function call, one method may be <dfn>more specific than</dfn> the other, or the methods may be <a name="MARKER-2-851"></a><dfn>ambiguous methods</dfn>.</p>
<p class="T1.Text1">To order two methods <var>A</var> and <var>B</var> with respect to a particular set of arguments, compare each of <var>A</var>'s specializers with <var>B</var>'s specializer in the corresponding position using the argument that was supplied for that position. The comparison works in the following way.</p>
<ul>
  <li><a name="MARKER-2-852"></a><a name="MARKER-2-853"></a>If the specializers are type equivalent, then <var>A</var> and <var>B</var> are unordered at the current argument position. That is, this argument position provides no information about the order of the two methods.</li>
  <li>Otherwise, if the specializer of <var>A</var> is a subtype of the specializer of <var>B</var>, then <var>A</var> precedes <var>B</var> at the current argument position.</li>
  <li>Otherwise, if both specializers are classes, then their order in the class precedence list of the argument's class is used to determine which is more specific. If <var>A</var>'s specializer precedes <var>B</var>'s specializer in the class precedence list of the argument's class, then <var>A</var> precedes <var>B</var> at the current argument position.</li>
  <li>Otherwise, the methods are unordered in the current argument position.</li>
</ul>
<p class="T1.Text1"><a name="MARKER-2-854"></a>The method <var>A</var> is more specific than the
  method <var>B</var> if and only if <var>A</var> precedes <var>B</var> in at least one argument
  position, and <var>B</var> does not precede <var>A</var> in any argument
  position. Similarly, <var>B</var> is more specific than <var>A</var> if and only if <var>B</var>
  precedes <var>A</var> in at least one argument position, and <var>A</var> does not
  precede <var>B</var> in any argument position. If neither of these cases apply then <var>A</var>
  and <var>B</var> are ambiguous methods.</p>
<p class="T1.Text1"><a name="MARKER-2-855"></a>When the applicable methods are sorted by
  specificity, the sorted list is divided into two parts, each possibly empty. The first part
  contains methods that are more specific than every method that follows them. The second part
  (which cannot itself be sorted) begins at the first point of ambiguity; there are at least two
  methods that could equally well go first in the second part. When a generic function is called, if
  the first part of the sorted applicable methods is empty then an error is signaled. Similarly, if
  the last method in the first part attempts to call next-method, an error is signaled.</p>
<p class="T1.Text1">Consider the following class definitions:</p>
<pre class="code">
define class &lt;sentient&gt; (&lt;life-form&gt;) end class;

define class &lt;bipedal&gt; (&lt;life-form&gt;) end class;

define class &lt;intelligent&gt; (&lt;sentient&gt;) end class;

define class &lt;humanoid&gt; (&lt;bipedal&gt;) end class;

define class &lt;vulcan&gt; (&lt;intelligent&gt;, &lt;humanoid&gt;) end class; 
</pre>
<p class="T1.Text1">Computing the class precedence list for <code>&lt;vulcan&gt; </code>yields </p>
<pre class="code">
#(&lt;vulcan&gt;,&lt;intelligent&gt;,&lt;sentient&gt;,&lt;humanoid&gt;,&lt;bipedal&gt;,&lt;life-form&gt;)
</pre>
<p class="T1.Text1">The class precedence lists computed for two different classes may have different precedence orders for some intermediate superclasses. This is not a problem as long as there is no class that inherits from both classes. For example, we could define a class <code>&lt;human&gt; </code>as follows:</p>
<pre class="code">
define class &lt;human&gt; (&lt;humanoid&gt;, &lt;intelligent&gt;) end class;
</pre>
<p class="T1.Text1">For the class <code>&lt;human&gt;</code> defined as above, the class precedence list would be</p>
<pre class="code">
#(&lt;human&gt;,&lt;humanoid&gt;,&lt;bipedal&gt;,&lt;intelligent&gt;,&lt;sentient&gt;,&lt;life-form&gt;)
</pre>
<p class="T1.Text1">It is not a problem that the two class precedence lists give different orders to some of the intermediate superclasses such as<code> &lt;bipedal&gt;</code> and <code>&lt;sentient&gt;</code>  as long as no class is added that inherits from both <code>&lt;vulcan&gt;</code> and <code>&lt;human&gt;</code>.</p>
<p class="T1.Text1">When sorting the applicable methods, each specializer needs to be viewed with respect to the class precedence list for the class of the argument passed to the generic function in that argument position. For example, given the following definitions</p>
<pre class="code">
define method psychoanalyze (being :: &lt;intelligent&gt;)
  &hellip;
end method;

define method psychoanalyze (being :: &lt;humanoid&gt;) 
  &hellip;
end method;
</pre>
<p class="T1.Text1">calling the generic function <code>psychoanalyze </code>on a being of type <code>&lt;human&gt;</code> would cause the method for <code>&lt;humanoid&gt;</code> to be called first, while calling the generic function on a being of type <code>&lt;vulcan&gt;</code> would cause the method for <code>&lt;intelligent&gt;</code> to be called first.</p>
<p class="T1.Text1"><a name="MARKER-2-856"></a>The order of arguments is not significant when computing method specificity. Given the above class definitions, the following methods are unambiguous when their generic function is called on two beings of type <code>&lt;vulcan&gt; </code>or two beings of type <code>&lt;human&gt;</code>, but the methods are ambiguous when the call includes one being of type <code>&lt;vulcan&gt; </code>and one of type <code>&lt;human&gt;</code>.</p>
<pre class="code">
define method superior-being (a :: &lt;intelligent&gt;,
                              b :: &lt;intelligent&gt;) 
  most-intelligent-being (a, b)
  end method;

define method superior-being (a :: &lt;humanoid&gt;,
                              b :: &lt;humanoid&gt;)
  best-looking-being (a, b)
  end method;<a name="MARKER-2-857"></a>
</pre>
<a name="HEADING50-32"></a>
<a name="UID-Functions-2171"></a>
<h2 class="subsection-title"><a name="MARKER-9-858"></a>Calling Less Specific Methods</h2>
<p class="T1.Text1"><a name="MARKER-2-859"></a>In many situations, a subtype wants to modify the behavior of a method, rather than replace it completely; it wants to perform some work but also use the inherited behavior. This can be accomplished with <dfn>next-method</dfn>. Next-method is a function that, when called, invokes the next most specific method applicable in the generic function. The next-method is the value of the <code>#next</code> parameter. Normally this parameter is named <code>next-method</code>, though it can have other names at the programmer's discretion.</p>
<p class="T1.Text1">One can think of next-method as invoking the method that would have been called if the current method did not exist.</p>
<p class="T1.Text1">If there are no more methods available, the next-method parameter will be bound to the value <code>#f</code> instead of to a method.</p>
<a name="HEADING50-36"></a>
<h3 class="sub-subsection-title">Passing Different Arguments to Next-Method</h3>
<p class="T1.Text1">In the usual case, next-method is called with no arguments. This indicates that the next-method should be passed the same arguments that were supplied to the current method.</p>
<p class="T1.Text1">It is valid to supply arguments, including different arguments, when calling next-method. However, if you pass different arguments, the new arguments must result in the same ordered sequence of applicable methods as the original arguments. Otherwise, the program behavior is undefined.</p>
<p class="T1.Text1"><a name="MARKER-2-860"></a>In some cases, the methods in a generic function accept different keyword arguments. In such cases, it's convenient for the methods also to accept a rest parameter. That way, all the keyword/value pairs passed to the generic function are captured in the rest parameter. By using <code>apply</code>, the next-method can be invoked with the complete set of arguments. (This technique is only necessary, of course, when the method calls next-method and passes arguments explicitly.)</p>
<p class="T1.Text1"><a name="MARKER-2-861"></a>As usual, if there are duplicates of a given keyword argument, the leftmost occurrence is used. This allows keyword arguments to be easily overridden.</p>
<a name="HEADING50-41"></a>
<h3 class="sub-subsection-title">The Next-Method Parameter</h3>
<p class="T1.Text1">The value of the next-method parameter is supplied by the generic function dispatch mechanism. When a method is called by its generic function, the generic function dispatch mechanism automatically passes the appropriate value for next-method. There is no way for a user program to specify the next-method argument when calling a method.</p>
<p class="T1.Text1">If you create a method directly (i.e., with <code>method</code> rather than with <code>define method</code>) and you want this method to accept a next-method parameter, then you should insert a <code>#next</code> into the parameter list explicitly. You would do this if you are creating a method that you plan to add to a generic function, and you want this method to be able to call next-method. You can also supply the next-method parameter when using <code>define method</code>, in cases where you want to give the parameter a different name.<a name="MARKER-2-862"></a><a name="MARKER-2-863"></a></p>

</div>

<div id="footer">

<hr class="footer" />
<address class="footer">The Dylan Reference Manual - 7 Apr 1998</address>
<p class="footer"><a class="previous" title="Go to previous page" href="drm_49.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_51.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_47.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
<p class="footer">Copyright Apple Computer, Inc. 1996. Apple&#174; and the Apple logo are registered trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
<p class="footer">Originally generated with <a href="http://www.harlequin.com/webmaker" class="footer">Harlequin WebMaker&#174;</a>, subsequently revised.</p>

</div>
</body>
</html>
