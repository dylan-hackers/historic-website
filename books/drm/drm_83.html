<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  
  <!-- Relative Navigation -->
  
  <link rel="up" href="drm_76.html" />
  <link rel="prev" href="drm_82.html" />
  <link rel="next" href="drm_84.html" />
  
  <!-- Absolute Navigation -->
  
  <link rel="top" href="drm_1.html" />
  <link rel="start first" href="index.html" />
  <link rel="copyright" href="drm_2.html" />
  <link rel="contents" href="drm_3.html" />
  <link rel="glossary" href="drm_126.html" />
  <link rel="index" href="drm_127.html" />
  <link rel="last author" href="drm_128.html" />
  
  <!-- Chapters -->
  
  <link rel="chapter" title="About This Book" href="drm_4.html" />
  <link rel="chapter" title="1 Introduction" href="drm_5.html" />
  <link rel="chapter" title="2 Syntax" href="drm_9.html" />
  <link rel="chapter" title="3 Program Structure" href="drm_25.html" />
  <link rel="chapter" title="4 Program Control" href="drm_28.html" />
  <link rel="chapter" title="5 Types and Classes" href="drm_38.html" />
  <link rel="chapter" title="6 Functions" href="drm_47.html" />
  <link rel="chapter" title="7 Conditions" href="drm_52.html" />
  <link rel="chapter" title="8 Collections" href="drm_59.html" />
  <link rel="chapter" title="9 Sealing" href="drm_70.html" />
  <link rel="chapter" title="10 Macros" href="drm_76.html" />
  <link rel="chapter" title="11 The Built-In Classes" href="drm_87.html" />
  <link rel="chapter" title="12 The Built-In Functions" href="drm_96.html" />
  <link rel="chapter" title="13 Other Built-In Objects" href="drm_108.html" />
  <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="drm_110.html" />
  
  <!-- Appendices -->
  
  <link rel="appendix" title="A BNF" href="drm_116.html" />
  <link rel="appendix" title="B Exported Names" href="drm_119.html" />
  
  <!-- Stylesheet -->
  
  <link rel="stylesheet" href="drm.css" type="text/css" />

  <title>Templates &mdash; 10. Macros &mdash; The DRM</title>
</head>
<body>

<div id="header">
<div id="navigation-header">
    <p id="book-title">The Dylan Reference Manual</p>
    <p id="basic-navigation"><a class="previous" title="Go to previous page" href="drm_82.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_84.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_76.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
  </div>

<div id="section-header">
  <p id="section-prefix">Chapter 10</p>
  <p id="section-name">Macros</p>
</div>

<div id="navigation-TOC">
  <ul class="front-matter">
    <li><a href="drm_1.html">Start</a></li>
    <li><a href="drm_3.html">Contents</a></li>
    <li><a href="drm_4.html">About This Book</a></li>
  </ul>
  <ol class="chapters">
    <li><a href="drm_5.html">Introduction</a></li>
    <li><a href="drm_9.html">Syntax</a></li>
    <li><a href="drm_25.html">Program Structure</a></li>
    <li><a href="drm_28.html">Program Control</a></li>
    <li><a href="drm_38.html">Types and Classes</a></li>
    <li><a href="drm_47.html">Functions</a></li>
    <li><a href="drm_52.html">Conditions</a></li>
    <li><a href="drm_59.html">Collections</a></li>
    <li><a href="drm_70.html">Sealing</a></li>
    <li><a href="drm_76.html">Macros</a>
      <ul>
	<li><a href="drm_77.html">Overview</a></li>
	<li><a href="drm_78.html">Extensible Grammar</a></li>
	<li><a href="drm_79.html">Macro Names</a></li>
	<li><a href="drm_80.html">Rewrite Rules</a></li>
	<li><a href="drm_81.html">Patterns</a></li>
	<li><a href="drm_82.html">Pattern Variable Constraints</a></li>
	<li id="current">Templates</li>
	<li><a href="drm_84.html">Auxiliary Rule Sets</a></li>
	<li><a href="drm_85.html">Hygiene</a></li>
	<li><a href="drm_86.html">Rewrite Rule Examples</a></li>
      </ul>
    </li>
    <li><a href="drm_87.html">The Built-In Classes</a></li>
    <li><a href="drm_96.html">The Built-In Functions</a></li>
    <li><a href="drm_108.html">Other Built-In Objects</a></li>
    <li><a href="drm_110.html">The Built-In Macros and Special Definitions</a></li>
  </ol>
  <ol class="appendices">
    <li><a href="drm_116.html">BNF</a></li>
    <li><a href="drm_119.html">Exported Names</a></li>
  </ol>
  <ul class="back-matter">
    <li><a href="drm_126.html">Glossary</a></li>
    <li><a href="drm_127.html">Index</a></li>
    <li><a href="drm_128.html">Colophon</a></li>
  </ul>
  <ul class="errata">
    <li><a href="drm_errata.html">Errata</a></li>
  </ul>
</div>

<hr />

</div>

<div id="content">
<a name="HEADING83-0"></a>
<a name="UID-Macros-1805"></a>
<h1 class="section-title">Templates</h1>
<p class="T1.Text1"><a name="MARKER-2-1262"></a>Approximately speaking, a template has the same structure as what it constructs, but contains pattern variables that will be replaced by fragments extracted from the macro call. Thus a template in the <var>main-rule-set</var>  looks like the macro expansion.</p>
<p class="T1.Text1">However, templates do not have a full grammar. A template is essentially any sequence of tokens and <var>substitutions</var> in which all of Dylan's brackets are balanced: <code>()</code>, <code>[]</code>, <code>{}</code>, <code>#()</code>, and <code>#[]</code>. Substitution for pattern variables produces a sequence of tokens and other elementary fragments.</p>
<p class="T1.Text1"><a name="MARKER-2-1263"></a>Note that using unparsed token sequences as templates allows a macro expansion to contain macro calls without creating any inter-dependencies between macros. Since the template is not parsed at macro definition time, any macros called in the template do not have to be defined first, and macros can be compiled independently of each other. This simplifies the implementation at the minor cost of deferring some error checking from when a macro is defined until the time when the macro is called.</p>
<p class="T1.Text1">The grammar for templates is the definition of <var>template </var> in <a href="drm_118.html#MARKER-9-2119" class="T1.Text1">"Templates" on page 429</a>.</p>
<p class="T1.Text1">All <var>template-elements</var>  other than <var>substitution</var>  are copied directly into the macro expansion. The various kinds of <var>substitution</var>  insert something else into the macro expansion, as follows:</p>
<dl>
  <dt><code>?</code> <em class="BNFCaps">name</em></dt>
  <dd><p>The fragment bound to the pattern variable named <em class="BNFCaps">name</em>.</p></dd>
  <dt><var>name-prefix<em><sub>opt</sub></em></var> <code>?</code> <var>name-string-or-symbol</var> <var>name-suffix<em><sub>opt</sub></em></var></dt>
  <dd><p>The fragment bound to the pattern variable named <var>name-string-or-symbol</var>, converted to a <em class="BNFCaps">string</em> or <em class="BNFCaps">symbol</em> and/or concatenated with a prefix and/or suffix. Note that this rule applies only when the first rule does not. The fragment must be a <em class="BNFCaps">name</em>. Concatenate the prefix, if any, the characters of the fragment, and the suffix, if any. The alphabetic case of the characters of the fragment is unspecified. Convert this to the same grammatical type (<em class="BNFCaps">name</em>, <em class="BNFCaps">string</em>, or <em class="BNFCaps">symbol</em>) as <var>name-string-or-symbol</var>. When the result is a <em class="BNFCaps">name</em>, its hygiene context is the same as that of the fragment.</p></dd>
  <dt><code>??</code> <em class="BNFCaps">name</em> <var>separator<em><sub>opt</sub></em></var> <code>...</code></dt>
  <dd><p>The sequence of fragments bound to the pattern variable named <em class="BNFCaps">name</em>, with <var>separator</var> inserted between each pair of fragments. The pattern variable must have been bound by a <code>??</code> <var>pattern-keyword.</var> <var>Separator</var> can be a binary operator, comma, or semicolon. If the size of the sequence is 1 or <var>separator</var> is omitted, no separator is inserted. If the sequence is empty, nothing is inserted.</p></dd>
  <dt><code>...</code></dt>
  <dd><p>The fragment bound to the pattern variable that names this rule set; this is only valid in an auxiliary rule set.</p></dd>
  <dt><code>?=</code> <em class="BNFCaps">name</em></dt>
  <dd><p>A reference to <em class="BNFCaps">NAME</em>, in the lexical context where the macro was called.</p></dd>
</dl>
<p class="T1.Text1">It is an error for a single question-mark <var>substitution</var>  to use a pattern variable that was bound by a double question-mark <var>pattern-keyword.</var> </p>
<p class="T1.Text1">It is an error for a double question-mark <var>substitution</var>  to use a pattern variable that was bound by a single question-mark <var>pattern-variable</var> or <var>pattern-keyword.</var> </p>
<p class="T1.Text1">It is an error for a <var>substitution</var> to use a pattern variable that does not appear on the left-hand side of the same rule.</p>
<p class="T1.Text1">When a template contains a <var>separator</var> immediately followed by a <var>substitution</var>, and the fragment inserted into the macro expansion by the <var>substitution</var> is empty, the separator is removed from the macro expansion.<a name="MARKER-2-1264"></a></p>

</div>

<div id="footer">

<hr class="footer" />
<address class="footer">The Dylan Reference Manual - 7 Apr 1998</address>
<p class="footer"><a class="previous" title="Go to previous page" href="drm_82.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_84.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_76.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
<p class="footer">Copyright Apple Computer, Inc. 1996. Apple&#174; and the Apple logo are registered trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
<p class="footer">Originally generated with <a href="http://www.harlequin.com/webmaker" class="footer">Harlequin WebMaker&#174;</a>, subsequently revised.</p>

</div>
</body>
</html>
