<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  
  <!-- Relative Navigation -->
  
  <link rel="up" href="drm_38.html" />
  <link rel="prev" href="drm_40.html" />
  <link rel="next" href="drm_42.html" />
  
  <!-- Absolute Navigation -->
  
  <link rel="top" href="drm_1.html" />
  <link rel="start first" href="index.html" />
  <link rel="copyright" href="drm_2.html" />
  <link rel="contents" href="drm_3.html" />
  <link rel="glossary" href="drm_126.html" />
  <link rel="index" href="drm_127.html" />
  <link rel="last author" href="drm_128.html" />
  
  <!-- Chapters -->
  
  <link rel="chapter" title="About This Book" href="drm_4.html" />
  <link rel="chapter" title="1 Introduction" href="drm_5.html" />
  <link rel="chapter" title="2 Syntax" href="drm_9.html" />
  <link rel="chapter" title="3 Program Structure" href="drm_25.html" />
  <link rel="chapter" title="4 Program Control" href="drm_28.html" />
  <link rel="chapter" title="5 Types and Classes" href="drm_38.html" />
  <link rel="chapter" title="6 Functions" href="drm_47.html" />
  <link rel="chapter" title="7 Conditions" href="drm_52.html" />
  <link rel="chapter" title="8 Collections" href="drm_59.html" />
  <link rel="chapter" title="9 Sealing" href="drm_70.html" />
  <link rel="chapter" title="10 Macros" href="drm_76.html" />
  <link rel="chapter" title="11 The Built-In Classes" href="drm_87.html" />
  <link rel="chapter" title="12 The Built-In Functions" href="drm_96.html" />
  <link rel="chapter" title="13 Other Built-In Objects" href="drm_108.html" />
  <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="drm_110.html" />
  
  <!-- Appendices -->
  
  <link rel="appendix" title="A BNF" href="drm_116.html" />
  <link rel="appendix" title="B Exported Names" href="drm_119.html" />
  
  <!-- Stylesheet -->
  
  <link title="Normal" rel="stylesheet" href="drm.css" type="text/css" />

  <title>The Dylan Reference Manual: Classes</title>
</head>
<body>

<div class="wm-div-body">
<a name="HEADING41"></a>

<div class="wm-div-headers">
<div id="navigation-header">
    <p id="book-title">The Dylan Reference Manual</p>
    <p id="basic-navigation"><a class="previous" title="Go to previous page" href="drm_40.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_42.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_38.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
  </div>

<div id="section-header">
  <p id="section-prefix">Chapter 5</p>
  <p id="section-name">Types and Classes</p>
</div>

<div id="navigation-TOC">
  <ul class="front-matter">
    <li><a href="drm_1.html">Start</a></li>
    <li><a href="drm_3.html">Contents</a></li>
    <li><a href="drm_4.html">About This Book</a></li>
  </ul>
  <ol class="chapters">
    <li><a href="drm_5.html">Introduction</a></li>
    <li><a href="drm_9.html">Syntax</a></li>
    <li><a href="drm_25.html">Program Structure</a></li>
    <li><a href="drm_28.html">Program Control</a></li>
    <li><a href="drm_38.html">Types and Classes</a>
      <ul>
	<li><a href="drm_39.html">Overview</a></li>
	<li><a href="drm_40.html">The Type Protocol</a></li>
	<li id="current">Classes
	  <ul>
	    <li><a href="#HEADING41-5">Features of Classes</a></li>
	    <li><a href="#HEADING41-11">Creating Classes</a></li>
	    <li><a href="#HEADING41-19">Class Inheritance</a></li>
	    <li><a href="#HEADING41-25">Computing the Class Precedence List</a></li>
	  </ul>
	</li>
	<li><a href="drm_42.html">Slots</a></li>
	<li><a href="drm_43.html">Instance Creation and Initialization</a></li>
	<li><a href="drm_44.html">Singletons</a></li>
	<li><a href="drm_45.html">Union Types</a></li>
	<li><a href="drm_46.html">Limited Types</a></li>
      </ul>
    </li>
    <li><a href="drm_47.html">Functions</a></li>
    <li><a href="drm_52.html">Conditions</a></li>
    <li><a href="drm_59.html">Collections</a></li>
    <li><a href="drm_70.html">Sealing</a></li>
    <li><a href="drm_76.html">Macros</a></li>
    <li><a href="drm_87.html">The Built-In Classes</a></li>
    <li><a href="drm_96.html">The Built-In Functions</a></li>
    <li><a href="drm_108.html">Other Built-In Objects</a></li>
    <li><a href="drm_110.html">The Built-In Macros and Special Definitions</a></li>
  </ol>
  <ol class="appendices">
    <li><a href="drm_116.html">BNF</a></li>
    <li><a href="drm_119.html">Exported Names</a></li>
  </ol>
  <ul class="back-matter">
    <li><a href="drm_126.html">Glossary</a></li>
    <li><a href="drm_127.html">Index</a></li>
    <li><a href="drm_128.html">Colophon</a></li>
  </ul>
  <ul class="errata">
    <li><a href="drm_errata.html">Errata</a></li>
  </ul>
</div>

<hr />

</div>

<a name="HEADING41-0"></a>
<a name="UID-Types_and_Classes-361"></a>
<h1 class="section-title"><a name="MARKER-2-561"></a>Classes</h1>
<p class="T1.Text1"><a name="MARKER-2-562"></a>Classes are used to define the inheritance, structure, and initialization of objects.</p>
<p class="T1.Text1">Every object is a <strong class="Bold"><a name="MARKER-2-563"></a><dfn>direct instance</dfn></strong> of exactly one class, and a general instance of  the <strong class="Bold"><a name="MARKER-2-564"></a><dfn>general superclasses</dfn></strong> of that class.</p>
<p class="T1.Text1">A class determines which <strong class="T1.Text1"><a name="MARKER-2-565"></a>slots</strong> its instances have. Slots are the local storage available within instances. They are used to store the state of objects.</p>
<p class="T1.Text1">Classes determine how their instances are initialized by using the <strong class="bold"><a name="MARKER-2-566"></a><dfn>initialization protocol</dfn></strong>.</p>
<a name="HEADING41-5"></a>
<a name="UID-Types_and_Classes-5438"></a>
<h2 class="subsection-title"><a name="MARKER-2-567"></a>Features of Classes</h2>
<p class="T1.Text1">There are four features of classes. These features relate to each other, but can be declared independently.</p>
<ul>
<li>A class can be <strong class="bold"><a name="MARKER-2-568"></a><dfn>abstract</dfn></strong> or <strong class="bold"><a name="MARKER-2-569"></a><dfn>concrete</dfn></strong>. If the class is concrete, it can have direct instances. If it is abstract, it cannot have direct instances, but only indirect instances.</li>
<li>A class can be <strong class="bold"><a name="MARKER-2-570"></a><dfn>instantiable</dfn></strong> or <strong class="bold"><a name="MARKER-2-571"></a><dfn>uninstantiable</dfn></strong>. If the class is instantiable, it can be used as the first argument to <code>make</code>. If it is uninstantiable, it cannot be used as the first argument to <code>make</code>.</li>
<li>A class can be <strong class="bold"><a name="MARKER-2-572"></a><dfn>primary</dfn></strong> or <strong class="bold"><a name="MARKER-2-573"></a><dfn>free</dfn></strong>. This controls how a class can be used for multiple inheritance. For a full description of this feature, see <a href="drm_73.html#MARKER-9-1106">"Declaring Characteristics of Classes" on page 134</a>.</li>
<li>A class can be <strong class="bold"><a name="MARKER-2-574"></a><dfn>sealed</dfn></strong> or <strong class="bold"><a name="MARKER-2-575"></a><dfn>open</dfn></strong>. This controls whether a class can be subclassed outside the library where it is defined. For a full description of this feature, see <a href="drm_73.html#MARKER-9-1106">"Declaring Characteristics of Classes" on page 134</a>.<a name="MARKER-2-576"></a></li>
</ul>
<a name="HEADING41-11"></a>
<a name="UID-Types_and_Classes-2532"></a>
<h2 class="subsection-title"><a name="MARKER-2-577"></a>Creating Classes</h2>
<p class="T1.Text1">New classes may be created by calling <a name="MARKER-2-578"></a><code>make</code> on <code>&lt;class&gt;</code>, or with the definition <a name="MARKER-2-579"></a><code>define class</code>. In most programs the latter is more commonly used.</p>
<p class="T1.Text1">When a class is created with <code>make</code>, it is instantiated and returned just like any other object. The options available when creating a class with <code>make</code> are described on <a href="drm_90.html#MARKER-9-1372" class="T1.Text1">page 191</a>.</p>
<p class="T1.Text1"><a name="MARKER-2-580"></a>When a class is created with <code>define class</code> it is used to initialize a new module binding. <code>define class</code> allows the specification of superclasses, slots, initialization behavior, and options related to sealing. The complete syntax of <code>define class</code> is given on <a href="drm_112.html#MARKER-9-2013" class="T1.Text1">page 378</a>.</p>
<p class="T1.Text1">The following simple class definition creates a class named by the module binding <code>&lt;new&gt;</code>. The class inherits from <code>&lt;object&gt;</code> and does not specify any slots.</p>
<pre class="code">
define class &lt;new&gt; (&lt;object&gt;)
end class &lt;new&gt;;
</pre>
<p class="T1.Text1">The following class definition illustrates the creation of a class with multiple superclasses. Again, there are no slots defined by the class.</p>
<pre class="code">
define class &lt;color-window&gt; (&lt;palette&gt;, &lt;window&gt;)
end class &lt;color-window&gt;;<a name="MARKER-2-581"></a>
</pre>
<a name="HEADING41-19"></a>
<a name="UID-Types_and_Classes-5460"></a>
<h2 class="subsection-title"><a name="MARKER-2-582"></a><a name="MARKER-9-583"></a>Class Inheritance</h2>
<p class="T1.Text1">When a class is created, its <strong class="bold"><a name="MARKER-2-584"></a><dfn>direct superclasses</dfn></strong> are specified. The new class directly inherits from these classes; it is a <strong class="bold"><a name="MARKER-2-585"></a><dfn>direct subclass</dfn></strong> of each of these classes. There can be no duplicates in the direct superclasses of a class.</p>
<p class="T1.Text1">The subclass relationship is transitive. If a class <var>C</var> is a direct subclass of <var>C<em><sub>1</sub></em></var>,  <var>C<em><sub>1</sub></em></var> is a direct subclass of <var>C<em><sub>2</sub></em></var>, and <var>C<em><sub>2</sub></em></var> is a direct subclass of <var>C<em><sub>3</sub></em></var>, then <var>C</var> is an <strong class="Bold"><a name="MARKER-2-586"></a><dfn>indirect subclass</dfn></strong> of <var>C<em><sub>2</sub></em></var> and <var>C<em><sub>3</sub></em></var>. A <strong class="Bold"><a name="MARKER-2-587"></a><dfn>general subclass</dfn></strong> is a direct or indirect subclass.</p>
<p class="T1.Text1">Inheritance cannot be <a name="MARKER-2-588"></a>circular. A class cannot be its own general subclass.</p>
<p class="T1.Text1">A class is a subtype of each of its general superclasses.</p>
<p class="T1.Text1">Every class is a general subclass of <code>&lt;object&gt;</code>.<a name="MARKER-2-589"></a></p>
<a name="HEADING41-25"></a>
<a name="UID-Types_and_Classes-7969"></a>
<h2 class="subsection-title"><a name="MARKER-9-590"></a><a name="MARKER-2-591"></a>Computing the Class Precedence List</h2>
<p class="T1.Text1">The definition of a class specifies a <a name="MARKER-2-592"></a>total ordering on that class and its direct superclasses. This ordering is called the <strong class="T1.Text1"><a name="MARKER-2-593"></a>local precedence order</strong>. In the local precedence order:</p>
<ul>
  <li>The class precedes its direct superclasses.</li>
  <li>Each direct superclass precedes all other direct superclasses that follow it in the sequence of direct superclasses given in the class definition.</li>
</ul>
<p class="T1.Text1">The <strong class="T1.Text1"><a name="MARKER-2-594"></a>class precedence list</strong> for a class <var>C</var> is a total ordering on <var>C</var> and its superclasses that is consistent with the local precedence order of <var>C</var> and with the class precedence lists of its superclasses. (Two lists are consistent if for every <var>A</var> and <var>B</var> that are each members of both lists, either <var>A</var> precedes <var>B</var> in both or <var>B</var> precedes <var>A</var> in both.) The class precedence list is used in determining the order of specificity of methods based on the types they are specialized on when dispatching;  for details, see <a href="drm_50.html#MARKER-9-844" class="T1.Text1">"Method Dispatch" on page 95</a>.</p>
<p class="T1.Text1">Sometimes there are several such consistent total orderings on <var>C</var> and its superclasses. Dylan uses a deterministic algorithm to compute the class precedence list, which chooses one of the consistent total orderings.</p>
<p class="T1.Text1">Sometimes there is no possible total ordering on <var>C</var> and its superclasses that is consistent with the local precedence orders for <var>C</var> and with the class precedence lists of its superclasses. In this case, the class precedence list cannot be computed, and an error is signaled.</p>
<p class="T1.Text1">Note that because the class precedence list for a class is consistent with the class precedence lists of its superclasses, inheritance in Dylan is <strong class="bold"><dfn>monotonic</dfn></strong>. That is, if a generic function call using a direct instance of <var>C</var> dispatches to a method specialized in that parameter position on an indirect superclass of <var>C</var>, then there is a direct superclass of <var>C</var> that has the same behavior.</p>
<p class="T1.Text1">To compute the class precedence list for class <var>C</var>, merge the local precedence order of the class with the class precedence lists of the direct superclasses of the class. Computing the class precedence list for <var>C</var> requires computing the class precedence lists for its superclasses. This does not lead to infinite recursion because circular class inheritance is prohibited.</p>
<p class="T1.Text1"><a name="MARKER-2-595"></a>Note that because the class precedence lists of the direct superclasses are consistent with their local precedence orders and with the class precedence lists of their direct superclasses, and so on, the class precedence list  for <var>C</var> is consistent with the local precedence orders and class precedence lists of all its superclasses and not just the direct superclasses.</p>
<p class="T1.Text1">The merge of several sequences is a sequence that contains each of the elements of the several input sequences. An element that appears in more than one of the input sequences appears only once in the output sequence. If two elements appear in the same input sequence, their order in the output sequence is the same as their order in that input sequence.</p>
<p class="T1.Text1">When there are several possible merges of the inputs, at each position in the output where there is a choice, pick the class that has a direct subclass closest to the end of the output sequence. (This is unambiguous because two candidates for a position cannot both be direct superclasses of the same class, since they would then be ordered by that class's local precedence order. This is easily computable because a class always follows its direct subclasses in the merge, therefore the most recently added direct subclass can be found by searching from the end to the beginning of the output sequence and the merge can be computed in one pass.)</p>
<p class="T1.Text1">This algorithm can be implemented with the following Dylan program:</p>
<pre class="code">
define constant compute-class-linearization =
  method (c :: &lt;class&gt;) =&gt; (cpl :: &lt;list&gt;)
    local method merge-lists (reversed-partial-result :: &lt;list&gt;,
                              remaining-inputs :: &lt;sequence&gt;)
            if (every?(empty?, remaining-inputs))
              reverse!(reversed-partial-result)
            else
              local method candidate (c :: &lt;class&gt;)
                      // returns c if it can go in the result now,
                      // otherwise false
                      local method head? (l :: &lt;list&gt;)
                              c == head(l)
                            end method head?,
                            method tail? (l :: &lt;list&gt;)
                              member?(c, tail(l))
                            end method tail?;
                      any?(head?, remaining-inputs)
                        &amp; ~any?(tail?, remaining-inputs)
                        &amp; c
                    end method candidate,
                    method candidate-direct-superclass (c :: &lt;class&gt;)
                      any?(candidate, direct-superclasses(c))
                    end method candidate-direct-superclass;
              let next = any?(candidate-direct-superclass,
                              reversed-partial-result);
              if (next)
                local method remove-next (l :: &lt;list&gt;)
                        if (head(l) == next) tail(l) else l end
                      end method remove-next;
                merge-lists(pair(next, reversed-partial-result),
                            map(remove-next, remaining-inputs))
              else
                error(&quot;Inconsistent precedence graph&quot;);
              end if
            end if
          end method merge-lists;
    let c-direct-superclasses = direct-superclasses(c);
    local method cpl-list (c)
            as(&lt;list&gt;, all-superclasses(c))
          end method cpl-list;
    merge-lists(list(c),
                add(map(cpl-list, c-direct-superclasses),
                    as(&lt;list&gt;, c-direct-superclasses)));
  end method; // compute-class-linearization
</pre>
<p class="T0.Text0">Note that the selection rule from above is enforced because <code>any?</code> uses the natural iteration order for sequences and returns the first true value it encounters when searching the reversed partially computed class precedence list.<a name="MARKER-2-596"></a><a name="MARKER-2-597"></a><a name="MARKER-2-598"></a></p>

</div>

<div class="wm-div-footers">

<hr class="footer" />
<address class="footer">The Dylan Reference Manual - 7 Apr 1998</address>
<p class="footer"><a class="previous" title="Go to previous page" href="drm_40.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_42.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_38.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
<p class="footer">Copyright Apple Computer, Inc. 1996. Apple&#174; and the Apple logo are registered trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
<p class="footer">Originally generated with <a href="http://www.harlequin.com/webmaker" class="footer">Harlequin WebMaker&#174;</a>, subsequently revised.</p>

</div>
</body>
</html>
