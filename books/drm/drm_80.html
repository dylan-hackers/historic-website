<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  
  <!-- Relative Navigation -->
  
  <link rel="up" href="drm_76.html" />
  <link rel="prev" href="drm_79.html" />
  <link rel="next" href="drm_81.html" />
  
  <!-- Absolute Navigation -->
  
  <link rel="top" href="drm_1.html" />
  <link rel="start first" href="index.html" />
  <link rel="copyright" href="drm_2.html" />
  <link rel="contents" href="drm_3.html" />
  <link rel="glossary" href="drm_126.html" />
  <link rel="index" href="drm_127.html" />
  <link rel="last author" href="drm_128.html" />
  
  <!-- Chapters -->
  
  <link rel="chapter" title="About This Book" href="drm_4.html" />
  <link rel="chapter" title="1 Introduction" href="drm_5.html" />
  <link rel="chapter" title="2 Syntax" href="drm_9.html" />
  <link rel="chapter" title="3 Program Structure" href="drm_25.html" />
  <link rel="chapter" title="4 Program Control" href="drm_28.html" />
  <link rel="chapter" title="5 Types and Classes" href="drm_38.html" />
  <link rel="chapter" title="6 Functions" href="drm_47.html" />
  <link rel="chapter" title="7 Conditions" href="drm_52.html" />
  <link rel="chapter" title="8 Collections" href="drm_59.html" />
  <link rel="chapter" title="9 Sealing" href="drm_70.html" />
  <link rel="chapter" title="10 Macros" href="drm_76.html" />
  <link rel="chapter" title="11 The Built-In Classes" href="drm_87.html" />
  <link rel="chapter" title="12 The Built-In Functions" href="drm_96.html" />
  <link rel="chapter" title="13 Other Built-In Objects" href="drm_108.html" />
  <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="drm_110.html" />
  
  <!-- Appendices -->
  
  <link rel="appendix" title="A BNF" href="drm_116.html" />
  <link rel="appendix" title="B Exported Names" href="drm_119.html" />
  
  <!-- Stylesheet -->
  
  <link title="Normal" rel="stylesheet" href="drm.css" type="text/css" />

  <title>The Dylan Reference Manual: Rewrite Rules</title>
</head>
<body>

<div class="wm-div-body">
<a name="HEADING80"></a>

<div class="wm-div-headers">
<div id="navigation-header">
    <p id="book-title">The Dylan Reference Manual</p>
    <p id="basic-navigation"><a class="previous" title="Go to previous page" href="drm_79.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_81.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_76.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
  </div>

<div id="section-header">
  <p id="section-prefix">Chapter 10</p>
  <p id="section-name">Macros</p>
</div>

<div id="navigation-TOC">
  <ul class="front-matter">
    <li><a href="drm_1.html">Start</a></li>
    <li><a href="drm_3.html">Contents</a></li>
    <li><a href="drm_4.html">About This Book</a></li>
  </ul>
  <ol class="chapters">
    <li><a href="drm_5.html">Introduction</a></li>
    <li><a href="drm_9.html">Syntax</a></li>
    <li><a href="drm_25.html">Program Structure</a></li>
    <li><a href="drm_28.html">Program Control</a></li>
    <li><a href="drm_38.html">Types and Classes</a></li>
    <li><a href="drm_47.html">Functions</a></li>
    <li><a href="drm_52.html">Conditions</a></li>
    <li><a href="drm_59.html">Collections</a></li>
    <li><a href="drm_70.html">Sealing</a></li>
    <li><a href="drm_76.html">Macros</a>
      <ul>
	<li><a href="drm_77.html">Overview</a></li>
	<li><a href="drm_78.html">Extensible Grammar</a></li>
	<li><a href="drm_79.html">Macro Names</a></li>
	<li id="current">Rewrite Rules</li>
	<li><a href="drm_81.html">Patterns</a></li>
	<li><a href="drm_82.html">Pattern Variable Constraints</a></li>
	<li><a href="drm_83.html">Templates</a></li>
	<li><a href="drm_84.html">Auxiliary Rule Sets</a></li>
	<li><a href="drm_85.html">Hygiene</a></li>
	<li><a href="drm_86.html">Rewrite Rule Examples</a></li>
      </ul>
    </li>
    <li><a href="drm_87.html">The Built-In Classes</a></li>
    <li><a href="drm_96.html">The Built-In Functions</a></li>
    <li><a href="drm_108.html">Other Built-In Objects</a></li>
    <li><a href="drm_110.html">The Built-In Macros and Special Definitions</a></li>
  </ol>
  <ol class="appendices">
    <li><a href="drm_116.html">BNF</a></li>
    <li><a href="drm_119.html">Exported Names</a></li>
  </ol>
  <ul class="back-matter">
    <li><a href="drm_126.html">Glossary</a></li>
    <li><a href="drm_127.html">Index</a></li>
    <li><a href="drm_128.html">Colophon</a></li>
  </ul>
  <ul class="errata">
    <li><a href="drm_errata.html">Errata</a></li>
  </ul>
</div>

<hr />

</div>

<a name="HEADING80-0"></a>
<a name="UID-Macros-1609"></a>
<h1 class="section-title">Rewrite Rules</h1>
<p class="T1.Text1"><a name="MARKER-2-1234"></a>The grammar of a macro definition is <span class="BNF"><code>define</code> <code>macro</code> <var>macro-definition</var></span>. For details see <a href="drm_116.html" class="T1.Text1">Appendix A, "BNF."</a></p>
<p class="T1.Text1">If the optional <em class="BNFCaps">name</em> at the end of a <var>macro-definition</var> is present, it must be the same <em class="BNFCaps">name</em> that appears at the beginning of the <var>macro-definition</var>.</p>
<p class="T1.Text1">The kind of macro being defined, and thus the Dylan grammar production that this macro extends, is determined by which kind of rules appear in the macro's <var>main-rule-set</var>.</p>
<p class="T1.Text1">The <em class="BNFCaps">name</em> preceding the <var>main-rule-set</var> is the name of the binding whose value is this macro. It must be consistent with each left-hand side of the <var>main-rule-set</var>. It can be any name, even a reserved word or backslash followed by an operator. For statement and function macros this <em class="BNFCaps">name</em> must be the same as the <em class="BNFCaps">name</em> that appears as the first token in each <var>main-rule-set</var> pattern. For definition macros this <em class="BNFCaps">name</em> must be the same as the <em class="BNFCaps">name</em> in the <var>xxx-style-definition-rule</var>  with the suffix "<code>-definer</code>" added.</p>
<p class="T1.Text1">A <em class="BNFCaps">name</em> can belong to more than one of the lexical categories <em class="BNFCaps">begin-word</em>, <em class="BNFCaps">function-word</em>, <em class="BNFCaps">define-body-word</em>, and <em class="BNFCaps">define-list-word</em>. A <em class="BNFCaps">name</em> cannot belong to both <em class="BNFCaps">begin-word</em> and <em class="BNFCaps">function-word</em>. A <em class="BNFCaps">name</em> cannot belong to both <em class="BNFCaps">define-body-word</em> and <em class="BNFCaps">define-list-word</em>.</p>
<p class="T1.Text1">For simplicity of documentation, the <var>xxx-style-definition-rule</var> productions are written ambiguously. The <em class="BNFCaps">name</em> in the left-hand side of the rule must be the <em class="BNFCaps">name</em> immediately following <code>define macro</code> with the "<code>-definer</code>" suffix removed, not an arbitrary <em class="BNFCaps">name</em>, which would be ambiguous with <var>modifier</var>.</p>
<p class="T1.Text1">The general idea is that the <var>main-rule-set</var> is an ordered sequence of rewrite rules. Macro expansion tests the macro call against each left-hand side in turn until one matches. The corresponding right-hand side supplies the new construct to replace the macro call. The left- and right-hand sides can contain pattern variables. The portion of the macro call that matches a particular pattern variable on the left replaces each occurrence of that pattern variable on the right. It is an error for the right-hand side of a rule to contain a pattern variable that does not appear on the left-hand side of the same rule.</p>
<p class="T1.Text1">If none of the left-hand sides match, the macro call is invalid. If more than one left-hand side matches, the first matching rule is used. Note that (as described in the next section) a pattern variable with a <a name="MARKER-2-1235"></a>wildcard constraint can match an empty portion of the macro call. A comma or a semicolon followed by a pattern variable with a wildcard constraint also can match an empty portion of the macro call. Do not assume that only an empty pattern can match an empty input. In general when writing recursive rewrite rules it is better to put the base case first, before the inductive cases, in case an inductive case rewrite rule might match a base case input.</p>
<p class="T1.Text1">The punctuation marks <code>?</code>, <code>??</code>, and <code>?=</code> used in patterns and templates are customarily written without any whitespace following them.<a name="MARKER-2-1236"></a></p>

</div>

<div class="wm-div-footers">

<hr class="footer" />
<address class="footer">The Dylan Reference Manual - 7 Apr 1998</address>
<p class="footer"><a class="previous" title="Go to previous page" href="drm_79.html"><img alt="Previous" src="prev.gif" /></a> <a class="next" title="Go to next page" href="drm_81.html"><img alt="Next" src="next.gif" /></a> <a class="up" title="Go to start of chapter" href="drm_76.html"><img alt="Up" src="up.gif" /></a> <a class="start" title="Go to start of book" href="drm_1.html"><img alt="Top" src="top.gif" /></a> <a class="contents" title="Go to table of contents" href="drm_3.html"><img alt="Contents" src="content.gif" /></a> <a class="index" title="Go to index" href="drm_127.html"><img alt="index" src="index.gif" /></a></p>
<p class="footer">Copyright Apple Computer, Inc. 1996. Apple&#174; and the Apple logo are registered trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
<p class="footer">Originally generated with <a href="http://www.harlequin.com/webmaker" class="footer">Harlequin WebMaker&#174;</a>, subsequently revised.</p>

</div>
</body>
</html>
