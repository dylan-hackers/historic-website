<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997) -->
<HEAD>
<LINK REL=TOP HREF="intero_1.htm">
<LINK REL=UP HREF="inter_29.htm">
<LINK REL=PREV HREF="inter_34.htm">
<LINK REL=NEXT HREF="inter_36.htm">
<TITLE> with-connection</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997)">
</HEAD>
<BODY BGCOLOR="#FEFEF2" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<DIV>
<A NAME=HEADING35></A>

<DIV>
<P><A HREF="inter_36.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="inter_34.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="inter_29.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="intero_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="intero_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="inte_579.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>1.2.6   Connecting and disconnecting</P>

</DIV>
<A NAME=HEADING35-0></A>
<H1> <A NAME=MARKER-2-177></A><A NAME=MARKER-2-178></A>with-connection</H1>
<P><I>Statement macro</I></P>
<H3>Summary</H3>
<P> Within the dynamic scope of the body, establishes the default connection.</P>
<H3>Signature</H3>
<DL><DD><PRE>with-connection(<I>connection</I>)
  <I>body</I> 
end [with-connection]</PRE></DL>
<H3>Arguments</H3>
<DL>
<P> </P><DT><I>connection</I><DD> An instance of <CODE>&lt;connection&gt;</CODE>.
</DL>
<H3>Library</H3>
<P> <CODE>sql</CODE></P>
<H3>Module</H3>
<P> <CODE>sql</CODE></P>
<H3>Description</H3>
<P> Within the dynamic scope of <I>body</I>, establishes the default connection as <I>connection</I>. The value of <I>connection</I> must be an instance of <CODE>&lt;connection&gt;</CODE> returned from the method <CODE>connect<A NAME=MARKER-10-179></A></CODE>. The result of this macro is the last expression executed within <I>body</I>.</P>
<P>Example:</P>
<P>This example queries the ODBC database library for the number of books published by Addison-Wesley and the number of books published by McGraw-Hill. This example is written in an unorthodox manner (two connections to the same database) to show that SQL statements may be executed against different established connections using the <CODE>with-connection</CODE> macro. The <CODE>&lt;result-set&gt;</CODE> class is discussed on page <A HREF="inter_65.htm#MARKER-9-256">34</A>.</P>
<PRE>
begin
  let db = make (&lt;odbc-database&gt;, name: &quot;library&quot;);
  let user = make(&lt;odbc-user&gt;, user: &quot;andrew&quot;, 
                  password: &quot;foobar&quot;);
  let a-connection :: &lt;connection&gt; = connect(db, user);
  let b-connection :: &lt;connection&gt; = connect(db, user);
<P></P>
  let aw-query = make (&lt;odbc-sql-statement&gt;,
    text: &quot;select count(*)
    from book
    where publisher = &quot;Addison-Wesley&quot;
  let addison-wesley-library :: &lt;result-set&gt; =
    with-connection(a-connection);
      execufte(aw-query),
    end with-connection;
  let first-record = addison-wesley-library[0];
  let addison-wesley-library-count = first-record[0];
  let mh-query = make (&lt;odbc-sql-statement&gt;, test:
        select count(*)
        from book
        where publisher = &quot;McGraw-Hill&quot;
  let mcgraw-hill-library :: &lt;result-set&gt; =
    with-connection(b-connection);
      execute(mh-query),
    end with-connection;
  let first-record = mcgraw-hill-library[0];
  let mcgraw-hill-library-count = first-record[0];
<P></P>
  disconnect-all();
  values(addison-wesley-library-count, 
         mcgraw-hill-library-count);
end;
<P></P>
=&gt; 2
   0
<P></P>
</PRE>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>OLE, COM, ActiveX and DBMS Reference - 31 MAR 2000</ADDRESS>
<P><A HREF="inter_36.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="inter_34.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="inter_29.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="intero_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="intero_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="inte_579.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
</BODY>
</HTML>
