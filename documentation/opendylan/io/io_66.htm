<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997) -->
<HEAD>
<LINK REL=TOP HREF="io_1.htm">
<LINK REL=UP HREF="io_65.htm">
<LINK REL=PREV HREF="io_65.htm">
<LINK REL=NEXT HREF="io_67.htm">
<TITLE>5.8.1   Wrapper streams and delegation</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997)">
</HEAD>
<BODY BGCOLOR="#FEFEF2" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<DIV>
<A NAME=HEADING66></A>

<DIV>
<P><A HREF="io_67.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="io_65.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="io_65.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="io_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="io_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="io_333.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>5.8   Wrapper streams</P>

</DIV>
<A NAME=HEADING66-0></A>
<H1>5.8.1   <A NAME=MARKER-2-378></A><A NAME=MARKER-2-379></A><A NAME=MARKER-2-380></A><A NAME=MARKER-9-381></A>Wrapper streams and delegation</H1>
<P>One problem with wrapper streams is the need for a wrapper stream to intercept methods invoked by its inner stream. For example, consider two hypothetical streams, <CODE>&lt;interactive-stream&gt;</CODE> and <CODE>&lt;dialog-stream&gt;</CODE>, the latter a subclass of <A HREF="io_136.htm#MARKER-9-777"><CODE>&lt;wrapper-stream&gt;</CODE></A>. Both of these classes have a method called <CODE>prompt</CODE>. The <CODE>&lt;interactive-stream&gt;</CODE> class specializes <A HREF="io_105.htm#MARKER-9-616"><CODE>read</CODE></A> thus:</P>
<PRE>
define method read (s :: &lt;interactive-stream&gt;, 
                    n :: &lt;integer&gt;,
                    #key on-end-of-stream);
  prompt(s);
  next-method()
end method; 
<P></P>
</PRE>
<P>If a <CODE>&lt;dialog-stream&gt;<EM> </EM></CODE>is used to wrap an <CODE>&lt;interactive-stream&gt;</CODE> then an invocation of <A HREF="io_105.htm#MARKER-9-616"><CODE>read</CODE></A> on the <CODE>&lt;dialog-stream&gt;</CODE> will call <CODE>prompt</CODE> on the inner <BR><CODE>&lt;interactive-stream&gt;</CODE>, not on the <CODE>&lt;dialog-stream&gt;</CODE>, as desired. The problem is that the <CODE>&lt;dialog-stream&gt;</CODE> delegates some tasks to its inner stream, but handles some other tasks itself.</P>
<P>Delegation by inner-streams to outer-streams is implemented by the use of the <A HREF="io_100.htm#MARKER-9-593"><CODE>outer-stream</CODE></A> function. The <A HREF="io_100.htm#MARKER-9-593"><CODE>outer-stream</CODE></A> function is used instead of the stream itself whenever a stream invokes one of its other protocol methods. </P>
<P>A correct implementation of the <A HREF="io_105.htm#MARKER-9-616"><CODE>read</CODE></A> method in the example above would be as follows:</P>
<PRE>
define method read (stream :: &lt;interactive-stream&gt;, 
                    n :: &lt;integer&gt;, 
                    #key on-end-of-stream)
  prompt(s.outer-stream);
  next-method()
end method;
<P></P>
</PRE>
<P>The <CODE>initialize</CODE> method on <A HREF="io_115.htm#MARKER-9-672"><CODE>&lt;stream&gt;</CODE></A> is defined to set the <A HREF="io_100.htm#MARKER-9-593"><CODE>outer-stream</CODE></A> slot to be the stream itself. The <CODE>initialize</CODE> method on <A HREF="io_136.htm#MARKER-9-777"><CODE>&lt;wrapper-stream&gt;</CODE></A> is specialized to set the <A HREF="io_100.htm#MARKER-9-593"><CODE>outer-stream</CODE></A> slot to be the "parent" stream:</P>
<PRE>
define method initialize (stream :: &lt;wrapper-stream&gt;,
                          #key on, #rest all-keys);
  an-inner-stream.outer-stream := stream;
  next-method()
end method;
</PRE>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>System and I/O Reference - 31 MAR 2000</ADDRESS>
<P><A HREF="io_67.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="io_65.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="io_65.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="io_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="io_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="io_333.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
</BODY>
</HTML>
