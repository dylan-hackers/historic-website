<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997) -->
<HEAD>
<LINK REL=TOP HREF="io_1.htm">
<LINK REL=UP HREF="io_48.htm">
<LINK REL=PREV HREF="io_53.htm">
<LINK REL=NEXT HREF="io_55.htm">
<TITLE>5.5.3   Locking streams</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997)">
</HEAD>
<BODY BGCOLOR="#FEFEF2" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<DIV>
<A NAME=HEADING54></A>

<DIV>
<P><A HREF="io_55.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="io_53.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="io_48.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="io_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="io_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="io_333.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>5.5   Stream classes </P>

</DIV>
<A NAME=HEADING54-0></A>
<H1>5.5.3   <A NAME=MARKER-2-301></A><A NAME=MARKER-2-302></A><A NAME=MARKER-9-303></A>Locking streams</H1>
<P>In an application where more than one control thread may access a common stream, it is important to match the granularity of locking to the transaction model of the application. Ideally, an application should lock a stream which is potentially accessed by multiple threads, only once per transaction. Repeated and unnecessary locking and unlocking can seriously degrade the performance of the Streams module. Thus an application which wishes to write a complex message to a stream that needs to be thread safe should lock the stream, write the message and then unlock the stream after the entire message is written. Locking and unlocking the stream for each character in the message would be a poor match of locking to transaction model. The time required for the lock manipulation would dominate the time required for the stream transactions. Unfortunately this means that there is no way for the Streams module to choose a default locking scheme without the likelihood of seriously degrading streams performance for all applications whose transaction models are different from the model implied by the chosen default locking scheme. Instead, the Streams module provides the user with a single, per instance slot, <CODE>stream-lock:</CODE>, which is inherited by all subclasses of <CODE>&lt;stream&gt;</CODE>. You should use the generic functions <CODE>stream-lock</CODE> and <CODE>stream-lock-setter</CODE>, together with other appropriate functions and macros from the Threads library, to implement a locking strategy appropriate to your application and its stream transaction model. The functions in the Streams module are not of themselves thread safe, and make no guarantees about the atomicity of read and write operations.</P>
<STRONG><A NAME=MARKER-2-304></A><A NAME=MARKER-2-305></A>stream-lock</STRONG>
<P><I>Open generic function</I></P>
<PRE>
stream-lock <I>stream</I> =&gt; <I>lock</I>
<P></P>
</PRE>
<DL>
<DT><DD>Returns the <I>lock</I> for the specified <I>stream</I>, or <CODE>#f</CODE> if no lock has been set. The <I>lock</I> argument is of type <CODE>&lt;lock&gt;</CODE>.
</DL>
<STRONG><A NAME=MARKER-2-306></A><A NAME=MARKER-2-307></A>stream-lock-setter</STRONG>
<P><I>Open generic function</I></P>
<PRE>
stream-lock-setter <I>stream lock</I> =&gt; <I>lock</I>
<P></P>
</PRE>
<DL>
<DT><DD>Sets the <I>lock</I> for the specified <I>stream</I>. The <I>lock</I> argument is of type <CODE>&lt;lock&gt;</CODE>, or <CODE>#f</CODE>. If <I>lock</I> is <CODE>#f</CODE>, the lock for <I>stream</I> is freed.
</DL>
<P>For full details on the <CODE>&lt;lock&gt;</CODE> class, see the documentation on the Threads library in the <I>Core Features and Mathematics</I><I></I> manual.</P>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>System and I/O Reference - 31 MAR 2000</ADDRESS>
<P><A HREF="io_55.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="io_53.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="io_48.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="io_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="io_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="io_333.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
</BODY>
</HTML>
