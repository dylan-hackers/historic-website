<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997) -->
<HEAD>
<LINK REL=TOP HREF="io_1.htm">
<LINK REL=UP HREF="io_68.htm">
<LINK REL=PREV HREF="io_68.htm">
<LINK REL=NEXT HREF="io_70.htm">
<TITLE>5.10.1   Positionable stream protocol</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997)">
</HEAD>
<BODY BGCOLOR="#FEFEF2" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<DIV>
<A NAME=HEADING69></A>

<DIV>
<P><A HREF="io_70.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="io_68.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="io_68.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="io_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="io_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="io_333.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>5.10   Streams protocols</P>

</DIV>
<A NAME=HEADING69-0></A>
<H1>5.10.1   <A NAME=MARKER-2-387></A><A NAME=MARKER-2-388></A>Positionable stream protocol</H1>
<P>This section describes the protocol for positionable streams.</P>
<P><A NAME=MARKER-10-389></A>A stream position can be thought of as a natural number that indicates how many elements into the stream the stream's current location is. However, it is not always the case that a single integer contains enough information to reposition a stream. Consider the case of an "uncompressing" file stream that requires additional state beyond simply the file position to be able to get the next input character from the compressed file.</P>
<P>The Streams module addresses this problem by introducing the class <A HREF="io_124.htm#MARKER-9-723"><CODE>&lt;stream-position&gt;</CODE></A>, which is subclassed by various kinds of stream implementations that need to maintain additional state. A stream can be repositioned as efficiently as possible when <A HREF="io_125.htm#MARKER-9-727"><CODE>stream-position-setter</CODE></A> is given a value previously returned by <A HREF="io_123.htm#MARKER-9-719"><CODE>stream-position</CODE></A> on that stream.</P>
<P>It is also legal to set the position of a stream to an integer position. However, for some types of streams, to do so might be slow, perhaps requiring the entire contents of the stream up to that point to be read.</P>
<STRONG><A NAME=MARKER-2-390></A><A NAME=MARKER-2-391></A>&lt;position-type&gt;</STRONG>
<P><I>Type</I></P>
<PRE>
type-union(&lt;stream-position&gt;, &lt;integer&gt;)
<P></P>
</PRE>
<DL>
<DT><DD>A type used to represent a position in a stream. In practice, positions within a stream are defined as instances of <CODE>&lt;integer&gt;</CODE>, but this type, together with the <CODE>&lt;stream-position&gt;</CODE> class, allows for cases where this might not be possible.
</DL>
<STRONG><A NAME=MARKER-2-392></A><A NAME=MARKER-2-393></A>&lt;stream-position&gt;</STRONG>
<P><I>Abstract class</I></P>
<DL>
<DT><DD>A direct subclass of <CODE>&lt;object&gt;</CODE>. It is used in rare cases to represent positions within streams that cannot be represented as instances of <CODE>&lt;integer&gt;</CODE>, such as a stream that supports compression.
</DL>
<STRONG><A NAME=MARKER-2-394></A><A NAME=MARKER-2-395></A>stream-position</STRONG>
<P><I>Open generic function</I></P>
<PRE>
stream-position <I>positionable-stream</I> =&gt; <I>position</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Returns the current position of <I>positionable-stream</I> for reading or writing.
</DL>
<STRONG><A NAME=MARKER-2-396></A><A NAME=MARKER-2-397></A><A NAME=MARKER-9-398></A>stream-position-setter</STRONG>
<P><I>Open generic function</I></P>
<PRE>
stream-position-setter <I>position</I> <I>positionable-stream</I> =&gt; <I>new-position</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Changes the stream's position to <I>position</I>, for reading or writing. 
<DT><DD>The following are all possible values of <I>position</I>: an integer between 0 and <I>positionable-stream<CODE>.stream-size</CODE></I>, a valid <A HREF="io_124.htm#MARKER-9-723"><CODE>&lt;stream-position&gt;</CODE></A>, <CODE>#&quot;start&quot;</CODE>, or <CODE>#&quot;end&quot;</CODE>.
<DT><DD><B>Note:</B> You cannot use <CODE>stream-position-setter</CODE> to set the position past the current last element of the stream: use <A HREF="io_72.htm#MARKER-9-447"><CODE>adjust-stream-position</CODE></A> instead.
</DL>
<STRONG><A NAME=MARKER-2-399></A><A NAME=MARKER-2-400></A>adjust-stream-position</STRONG>
<P><I>Open generic function</I></P>
<PRE>
adjust-stream-position <I>positionable-stream</I> <I>delta</I> #key <I>from</I> 
=&gt; <I>new-position</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Moves the position of <I>positionable-stream</I> to be offset <I>delta</I> elements from the position indicated by <I>from</I>. The new position is returned. The <I>delta</I> offset must be an instance of <CODE>&lt;integer&gt;</CODE>.
<DT><DD>The value of <I>from</I> can be one of the symbols <CODE>#&quot;current&quot;</CODE>, <CODE>#&quot;start&quot;</CODE>, and <CODE>#&quot;end&quot;</CODE>. The default is <CODE>#&quot;current&quot;</CODE>. 
<DT><DD>Using <A HREF="io_72.htm#MARKER-9-447"><CODE>adjust-stream-position</CODE></A> to set the position of a stream to be beyond its current last element grows the underlying aggregate to a new size. 
</DL>
<STRONG><A NAME=MARKER-2-401></A><A NAME=MARKER-2-402></A>as</STRONG>
<P><I>G.f. method</I></P>
<PRE>
as <I>integer-class</I> <I>stream-position</I> =&gt; <I>integer</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Coerces a <A HREF="io_124.htm#MARKER-9-723"><CODE>&lt;stream-position&gt;</CODE></A> to an integer. The <I>integer-class</I> argument is the class <CODE>&lt;integer&gt;</CODE>.
</DL>
<STRONG><A NAME=MARKER-2-403></A><A NAME=MARKER-2-404></A>stream-size</STRONG>
<P><I>Open generic function</I></P>
<PRE>
stream-size <I>positionable-stream</I> =&gt; <I>size</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Returns the number of elements in <I>positionable-stream</I>. 
<DT><DD>For input streams, this is the number of elements that were available when the stream was created. It is unaffected by any read operations that might have been performed on the stream. 
<DT><DD>For output and input-output streams, this is the number of elements that were available when the stream was created (just as with input streams), added to the number of elements written past the end of the stream (regardless of any repositioning operations). 
</DL>
<STRONG><A NAME=MARKER-2-405></A><A NAME=MARKER-2-406></A>stream-contents</STRONG>
<P><I>Open generic function</I></P>
<PRE>
stream-contents <I>positionable-stream</I> #key <I>clear-contents?</I> =&gt; <I>sequence</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Returns a sequence that contains all of <I>positionable-stream</I>'s elements from its start to its end, regardless of its current position. The type of the returned sequence is as for <A HREF="io_105.htm#MARKER-9-616"><CODE>read</CODE></A>. See page <A HREF="io_56.htm#MARKER-9-322">44</A>.
<DT><DD>The <I>clear-contents?</I> argument only applies to writeable sequence streams. If clear-contents? is <CODE>#t</CODE> (the default for streams to which it is applicable), this function sets the size of the stream to zero, and the position to the stream's start. Thus the next call to <A HREF="io_117.htm#MARKER-9-684"><CODE>stream-contents</CODE></A> will return only the elements written after the previous call to <A HREF="io_117.htm#MARKER-9-684"><CODE>stream-contents</CODE></A>. The <I>clear-contents?</I> argument is not defined for file streams, or any other external stream. It is also an error to apply it to input-only streams.
<DT><DD><B>Note:</B> You must use <A HREF="io_112.htm#MARKER-9-657"><CODE>read-to-end</CODE></A> for input streams.
</DL>
<STRONG><A NAME=MARKER-2-407></A><A NAME=MARKER-2-408></A><A NAME=MARKER-9-409></A>unread-element</STRONG>
<P><I>Open generic function</I></P>
<PRE>
unread-element <I>positionable-stream</I> <I>element</I> =&gt; <I>element</I> 
<P></P>
</PRE>
<DL>
<DT><DD>Returns <I>element</I> to <I>positionable-stream</I> so that the next call to <BR><A HREF="io_106.htm#MARKER-9-622"><CODE>read-element</CODE></A> returns <I>element</I>. It is an error if <I>element</I> was not the last element read from the stream. You may not call <CODE>unread-element</CODE> more than once without an intervening read operation (that is, you cannot unread more than one element at a time).
</DL>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>System and I/O Reference - 31 MAR 2000</ADDRESS>
<P><A HREF="io_70.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="io_68.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="io_68.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="io_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="io_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="io_333.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
</BODY>
</HTML>
