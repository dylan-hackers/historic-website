<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997) -->
<HEAD>
<LINK REL=TOP HREF="intero_1.htm">
<LINK REL=UP HREF="inter_95.htm">
<LINK REL=PREV HREF="inter_97.htm">
<LINK REL=NEXT HREF="inter_99.htm">
<TITLE> with-stack-structure</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997)">
</HEAD>
<BODY BGCOLOR="#FEFEF2" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<DIV>
<A NAME=HEADING98></A>

<DIV>
<P><A HREF="inter_99.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="inter_97.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="inter_95.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="intero_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="intero_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="inte_152.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>1.8   Allocating and deallocating C storage</P>

</DIV>
<A NAME=HEADING98-0></A>
<H1> <A NAME=MARKER-2-555></A>with-stack-structure</H1>
<P><I>Statement macro</I></P>
<H3>Summary</H3>
<P> Allocates an object within the scope of the body of the code.</P>
<H3>Signature</H3>
<DL><DD><PRE>with-stack-structure (<I>name</I> :: <I>wrapper-type</I> 
                      #key <I>element-count</I> <I>extra-bytes</I>) 
  <I>body</I> 
end [with-stack-structure]</PRE></DL>
<H3>Arguments</H3>
<DL>
<P> </P><DT><I>name</I><DD> A Dylan variable name.
<P> </P><DT><I>wrapper-type</I><DD> A Dylan name.
<P> </P><DT><I>element-count</I><DD> An instance of <CODE>&lt;integer&gt;</CODE>.
<P> </P><DT><I>extra-bytes</I><DD> An instance of <CODE>&lt;integer&gt;</CODE>.
</DL>
<H3>Library</H3>
<P> <CODE>c-ffi</CODE></P>
<H3>Module</H3>
<P> <CODE>c-ffi</CODE></P>
<H3>Description</H3>
<P> Allocates an object <I>name</I> within the scope of a <I>body</I>. The element-count and extra-bytes options behave as in <CODE>make</CODE>. The memory that was allocated is freed after <EM>body</EM> exits. </P>
<P>This macro gives the object <I>dynamic</I> <I>extent.</I></P>
<PRE>
? define C-struct &lt;PointStruct&gt;
    slot x-coord :: &lt;C-unsigned-short&gt;;
    slot y-coord :: &lt;C-unsigned-short&gt;;
    pointer-type-name: &lt;PointStruct*&gt;
  end C-struct;
<P></P>
// Defined &lt;PointStruct&gt;, x-coord, x-coord-setter, 
// y-coord, and y-coord-setter.
<P></P>
? define constant &lt;Point&gt; = &lt;PointStruct*&gt;;
// Defined &lt;Point&gt;.
<P></P>
? define C-function PlotPoint
    parameter point :: &lt;Point&gt;;
    c-name: &quot;PlotPoint&quot;;
  end C-function;
// Defined PlotPoint.
<P></P>
? define method plot (x, y)
    with-stack-structure (point :: &lt;Point&gt;)
      point.x-coord := 20;
      point.y-coord := 30;
      PlotPoint(point);
    end;
  end;
// Defined plot.
<P></P>
? plot(20, 20);
<P></P>
? plot(50, 50);
<P></P>
</PRE>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>C FFI and Win 32 Reference - 31 MAR 2000</ADDRESS>
<P><A HREF="inter_99.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="inter_97.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="inter_95.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="intero_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="intero_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="inte_152.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
</BODY>
</HTML>
