<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997) -->
<HEAD>
<LINK REL=TOP HREF="dguide_1.htm">
<LINK REL=UP HREF="dguid_38.htm">
<LINK REL=PREV HREF="dguid_42.htm">
<LINK REL=NEXT HREF="dguid_44.htm">
<TITLE>5.3.1.5   The save-task-list function</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997)">
</HEAD>
<BODY BGCOLOR="#FEFEF2" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<DIV>
<A NAME=HEADING43></A>

<DIV>
<P><A HREF="dguid_44.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="dguid_42.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="dguid_38.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="dguide_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="dguide_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="dgui_110.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>5.3.1   Handling files in the task list manager</P>

</DIV>
<A NAME=HEADING43-0></A>
<H1>5.3.1.5   <A NAME=MARKER-2-269></A><A NAME=MARKER-9-270></A>The save-task-list function</H1>
<P>The code for <CODE>save-task-list</CODE> is shown below. Because this function does not use any DUIM code, it is described only briefly.</P>
<PRE>
define function save-task-list
    (task-list :: &lt;task-list&gt;, #key filename)
 =&gt; (saved? :: &lt;boolean&gt;)
  let filename = filename | task-list-filename(task-list);
  with-open-file (stream = filename, direction: #&quot;output&quot;)
    for (task in task-list.task-list-tasks)
      format(stream, &quot;%s\n%s\n&quot;,
             task.task-name, as(&lt;string&gt;, task.task-priority))
    end
  end;
  task-list.task-list-modified? := #f;
  task-list.task-list-filename := filename;
  #t
end function save-task-list;
<P></P>
</PRE>
<P><A NAME=MARKER-10-271></A>Add this code to <CODE>task-list.dylan</CODE>.</P>
<P>The function <CODE>save-task-list</CODE> takes an instance of <CODE>&lt;task-list&gt;</CODE> as an argument, and optionally a <CODE>filename</CODE>. It then attempts to save the instance of <CODE>&lt;task-list&gt;</CODE> to the file specified by <CODE>filename</CODE>. It returns a boolean value that indicates whether the file was successfully saved or not. If filename is not passed as an argument to <CODE>save-task-list</CODE> (in the case where the user has chosen <B>File &gt; Save</B> or clicked the <B>Save</B> button when working with a task list file that has previously been saved), then the <CODE>task-list-filename</CODE> slot of the <CODE>&lt;task-list&gt;</CODE> is used instead. </P>
<P>Like <CODE>load-task-list</CODE>, this function uses the Streams library to save information to a file. For full information about this library, please refer to the <I>I/O and Networks Library Reference</I>. It also uses the <CODE>format</CODE> function from the Format library, which is described in the same reference.</P>
<P>The file is opened for saving using the <CODE>with-open-file</CODE> macro (just like <CODE>load-task-list</CODE>, but in the opposite direction), A <CODE>for</CODE> loop is used to save each element in each task to the file. The <CODE>format</CODE> function then writes each element to the file, separated by a newline character. Note how the <CODE>as</CODE> method is used to convert the <CODE>task-priority</CODE> symbol to a string when saving each priority value: this is the reverse situation to <CODE>load-task-list</CODE>, where a method for <CODE>as</CODE> was used to convert the string to a symbol.</P>
<P>Once every element in the file has been saved, the <CODE>task-list-modified</CODE> slot of the <CODE>&lt;task-list&gt;</CODE> is reset to <CODE>#f</CODE>, and the <CODE>task-list-filename</CODE> slot of the <CODE>&lt;task-list&gt;</CODE> is set to the filename used by <CODE>save-task-list</CODE>. This last step is necessary to allow for the case where the user has chosen the <B>File &gt; Save As</B> command to save the file under a different name.</P>
<P>Finally, <CODE>save-task-list</CODE> returns <CODE>#t</CODE> to indicate that the file has been successfully saved.</P>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>Building Applications Using DUIM - 26 May 1999</ADDRESS>
<P><A HREF="dguid_44.htm"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="dguid_42.htm"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="dguid_38.htm"><IMG ALIGN=BOTTOM SRC=up.gif ALT=Up BORDER=0></A> <A HREF="dguide_1.htm"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="dguide_2.htm"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="dgui_110.htm"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
</BODY>
</HTML>
